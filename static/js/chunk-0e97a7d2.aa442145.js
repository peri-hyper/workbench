(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e97a7d2"],{"5ec5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDivVisible,expression:"isDivVisible"}]},[a("h4",[e._v("您正在编辑发货单："+e._s(e.current_shippingid))]),a("vxe-toolbar",{scopedSlots:e._u([{key:"buttons",fn:function(){return[a("vxe-button",{attrs:{icon:"vxe-icon-square-plus",status:"primary"},on:{click:e.addProductEvent}},[e._v("添加产品")]),a("vxe-button",{attrs:{icon:"vxe-icon-save",status:"primary"},on:{click:e.saveEvent}},[e._v("保存")])]},proxy:!0}])}),a("vxe-form",{staticStyle:{"margin-left":"-10px"},attrs:{"title-align":"right","title-width":"100"}},[a("vxe-form-item",{attrs:{title:"客户名称",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:e.modalForm.customer_name,callback:function(t){e.$set(e.modalForm,"customer_name",t)},expression:"modalForm.customer_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"出货日期",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalForm.delivery_date,callback:function(t){e.$set(e.modalForm,"delivery_date",t)},expression:"modalForm.delivery_date"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"收货地址",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.shipping_options.shipping_address_options,clearable:"",filterable:""},on:{change:e.getProjectInfo},model:{value:e.modalForm.shipping_address,callback:function(t){e.$set(e.modalForm,"shipping_address",t)},expression:"modalForm.shipping_address"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"司机",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.shipping_options.driver_name_options,clearable:"",filterable:""},on:{change:e.getDriverInfo},model:{value:e.modalForm.driver_name,callback:function(t){e.$set(e.modalForm,"driver_name",t)},expression:"modalForm.driver_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"发货人",span:4},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.shipping_options.username_options,clearable:"",filterable:""},model:{value:e.modalForm.username,callback:function(t){e.$set(e.modalForm,"username",t)},expression:"modalForm.username"}})]},proxy:!0}])})],1),a("vxe-form",{staticStyle:{"margin-left":"-10px"},attrs:{"title-align":"right","title-width":"100"}},[a("vxe-form-item",{attrs:{title:"收货人",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:e.modalForm.project_contact_name,callback:function(t){e.$set(e.modalForm,"project_contact_name",t)},expression:"modalForm.project_contact_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"收货联系方式",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:e.modalForm.project_contact_phone,callback:function(t){e.$set(e.modalForm,"project_contact_phone",t)},expression:"modalForm.project_contact_phone"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"车牌",span:5},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:e.modalForm.licence_plate,callback:function(t){e.$set(e.modalForm,"licence_plate",t)},expression:"modalForm.licence_plate"}})]},proxy:!0}])})],1),a("vxe-table",{ref:"xTable",attrs:{border:"","show-overflow":"","keep-source":"","max-height":"400",data:e.shiptableData,"edit-config":{trigger:"click",mode:"cell",icon:"vxe-icon-edit",showStatus:!0}}},[a("vxe-column",{attrs:{type:"seq",width:"60",title:"序号"}}),a("vxe-column",{attrs:{field:"detailid",title:"产品编号",visible:!1},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.detailid,callback:function(t){e.$set(i,"detailid",t)},expression:"row.detailid"}})]}}])}),a("vxe-column",{attrs:{field:"order_number_id",title:"订单编号"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.order_number_id,callback:function(t){e.$set(i,"order_number_id",t)},expression:"row.order_number_id"}})]}}])}),a("vxe-column",{attrs:{field:"commodity_details",title:"品名"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.commodity_details,callback:function(t){e.$set(i,"commodity_details",t)},expression:"row.commodity_details"}})]}}])}),a("vxe-column",{attrs:{field:"commodity_size",title:"规格"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.commodity_size,callback:function(t){e.$set(i,"commodity_size",t)},expression:"row.commodity_size"}})]}}])}),a("vxe-column",{attrs:{field:"control_no",title:"编号"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.control_no,callback:function(t){e.$set(i,"control_no",t)},expression:"row.control_no"}})]}}])}),a("vxe-column",{attrs:{field:"commodity_units",title:"单位"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.commodity_units,callback:function(t){e.$set(i,"commodity_units",t)},expression:"row.commodity_units"}})]}}])}),a("vxe-column",{attrs:{field:"shipping_quantity",title:"发货数量","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{change:function(t){return e.handleChange(i)}},nativeOn:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnterUp(i)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.onDownUp(i)}]},model:{value:i.shipping_quantity,callback:function(t){e.$set(i,"shipping_quantity",t)},expression:"row.shipping_quantity"}})]}}])}),a("vxe-column",{attrs:{field:"shipping_weight",title:"发货重量"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.shipping_weight,callback:function(t){e.$set(i,"shipping_weight",t)},expression:"row.shipping_weight"}})]}}])}),a("vxe-column",{attrs:{field:"unit_weight",title:"单件重量"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.unit_weight,callback:function(t){e.$set(i,"unit_weight",t)},expression:"row.unit_weight"}})]}}])}),a("vxe-column",{attrs:{field:"commodity_quantity",title:"库存数量"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.commodity_quantity,callback:function(t){e.$set(i,"commodity_quantity",t)},expression:"row.commodity_quantity"}})]}}])}),a("vxe-column",{attrs:{field:"备注",title:"备注"},scopedSlots:e._u([{key:"edit",fn:function(t){var i=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:i.remarks,callback:function(t){e.$set(i,"remarks",t)},expression:"row.remarks"}})]}}])}),a("vxe-column",{attrs:{title:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("vxe-button",{attrs:{status:"danger",content:"删除"},on:{click:function(t){return e.deleteRowEvent(i)}}})]}}])})],1),a("vxe-modal",{attrs:{title:"选择产品",width:"800",resize:"","destroy-on-close":""},model:{value:e.modalDisplay,callback:function(t){e.modalDisplay=t},expression:"modalDisplay"}},[a("div",{staticStyle:{"text-align":"center","margin-top":"10px","margin-bottom":"10px"}},[a("vxe-input",{attrs:{placeholder:"请输入订单号码"},model:{value:e.searchOrderNumber,callback:function(t){e.searchOrderNumber=t},expression:"searchOrderNumber"}}),a("vxe-button",{attrs:{status:"primary",content:"搜索"},on:{click:e.searchProductBtn}})],1),a("vxe-table",{ref:"xTableOrders",attrs:{data:e.tableData,"checkbox-config":{checkField:"checked"}}},[a("vxe-column",{attrs:{type:"checkbox",title:"选择",width:"80"}}),a("vxe-column",{attrs:{field:"commodity_details",title:"品名"}}),a("vxe-column",{attrs:{field:"order_number_id",title:"订单号码"}}),a("vxe-column",{attrs:{field:"commodity_size",title:"规格"}}),a("vxe-column",{attrs:{field:"control_no",title:"编号"}}),a("vxe-column",{attrs:{field:"commodity_quantity",title:"库存数量"}})],1),a("vxe-pager",{attrs:{align:"center",size:"mini",background:"","current-page":e.tablePage.currentPage,"page-size":e.tablePage.pageSize,total:e.tablePage.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Total"]},on:{"update:currentPage":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:current-page":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.tablePage,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tablePage,"pageSize",t)},"page-change":e.handlePageChange}}),a("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[a("vxe-button",{attrs:{status:"primary",content:"确认"},on:{click:e.addProductListEvent}})],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isDivVisible,expression:"!isDivVisible"}]},[a("h4",[e._v("提示：请先到发货单管理菜单选择要编辑的发货单。")])])])},n=[],o=a("b85c"),r=a("c7eb"),l=a("1da1"),c=a("5530"),s=(a("7db0"),a("c740"),a("d81d"),a("fb6a"),a("a434"),a("b0c0"),a("b680"),a("d3b7"),a("a388")),d=a.n(s),u=a("d96b"),p=a("2f62"),m={computed:Object(c["a"])({},Object(p["b"])(["sidebar","avatar","device","name"])),data:function(){return{tablePage:{total:0,currentPage:1,pageSize:5},checkboxConfig:{reserve:!0},isDivVisible:!1,current_shippingid:"",shipping_options:{},modalForm:{project_contact_name:"",shipping_address:"",project_contact_phone:"",driver_name:"",customer_name:"",delivery_date:"",licence_plate:"",username:"",order_number_id:""},searchOrderNumber:"",modalDisplay:!1,tableData:[],shiptableData:[]}},watch:{modalForm:function(e){console.log("modalForm updated:",e)}},created:function(){this.current_shippingid=this.$route.query.shippingid,void 0===this.$route.query.shippingid?this.isDivVisible=!1:(this.isDivVisible=!0,this.getShippingInfo(),this.getShippingProductList(),this.getShippingOptions())},mounted:function(){var e=this;this.timer=setTimeout((function(){e.getProductList(),console.log("ok")}),1e3)},methods:{handleChange:function(e){e.shipping_quantity-e.commodity_quantity>0?(d.a.modal.message({content:"发货数量不可大于库存数量",status:"error"}),e.shipping_quantity=""):e.shipping_weight=(e.shipping_quantity*e.unit_weight).toFixed(2)},onEnterUp:function(e,t){this.gotoNextRow(e)},onDownUp:function(e){e.shipping_quantity=e.commodity_quantity,e.shipping_weight=(e.shipping_quantity*e.unit_weight).toFixed(2),this.gotoNextRow(e)},getProjectInfo:function(e){var t=this,a=e.value,i=(e.$event,{action:"project_table_view",subaction:"getProjectInfo",shipping_address:a});Object(u["a"])(i).then((function(e){t.modalForm.project_contact_name=e.data.project_contact_name,t.modalForm.project_contact_phone=e.data.project_contact_phone}))},getDriverInfo:function(e){var t=this,a=e.value,i=(e.$event,{action:"driver_table_view",subaction:"getDriverInfo",driver_name:a});Object(u["a"])(i).then((function(e){t.modalForm.licence_plate=e.data.licence_plate}))},getShippingOptions:function(){var e=this,t={action:"shipping_detail_table_view",subaction:"getShippingOptions"};Object(u["a"])(t).then((function(t){e.shipping_options=t.data}))},getShippingInfo:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={action:"shipping_table_view",subaction:"getShippingInfoByShippingId",shippingid:e.current_shippingid},Object(u["a"])(a).then((function(t){var a=t.data[0];e.modalForm.shippingid=e.current_shippingid,e.modalForm.project_contact_name=a.project_contact_name,e.modalForm.shipping_address=a.shipping_address,e.modalForm.project_contact_phone=a.project_contact_phone,e.modalForm.driver_name=a.driver_name,e.modalForm.customer_name=a.customer_name,e.modalForm.delivery_date=a.delivery_date,e.modalForm.licence_plate=a.licence_plate,e.modalForm.username=a.username,e.modalForm.order_number_id=a.order_number_id}));case 2:case"end":return t.stop()}}),t)})))()},getShippingProductList:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={action:"shipping_detail_table_view",subaction:"getProductListByShippingId",shippingid:e.current_shippingid},Object(u["a"])(a).then((function(t){e.shiptableData=t.data;var a,i=Object(o["a"])(e.shiptableData);try{for(i.s();!(a=i.n()).done;){var n=a.value;n.commodity_quantity=n.commodity_quantity+n.shipping_quantity}}catch(r){i.e(r)}finally{i.f()}}));case 2:case"end":return t.stop()}}),t)})))()},getProductList:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(e.modalForm),console.log(e.modalForm.customer_name),a={action:"order_detail_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{customer_name:e.modalForm.customer_name,username:e.name}},Object(u["a"])(a).then((function(t){e.allData=t.data,e.allData=e.allData.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{checked:!1})}));var a,i=e.shiptableData,n=Object(o["a"])(i);try{var r=function(){var t=a.value,i=e.allData.findIndex((function(e){return e.detailid===t.detailid}));-1!==i&&(e.allData[i].checked=!0)};for(n.s();!(a=n.n()).done;)r()}catch(d){n.e(d)}finally{n.f()}console.log(e.allData),e.tablePage.total=t.data.length;var l=5*(e.tablePage.currentPage-1),s=l+5;e.tableData=e.allData.slice(l,s)}));case 4:case"end":return t.stop()}}),t)})))()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.tablePage.currentPage=t,this.tablePage.pageSize=a;var i=(this.tablePage.currentPage-1)*this.tablePage.pageSize,n=i+this.tablePage.pageSize;this.tableData=this.allData.slice(i,n)},searchProductBtn:function(){var e=this;return Object(l["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={action:"order_detail_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{customer_name:e.modalForm.customer_name,order_number__icontains:e.searchOrderNumber,username:e.name}},Object(u["a"])(a).then((function(t){e.allData=t.data,e.allData=e.allData.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{checked:!1})}));var a,i=e.shiptableData,n=Object(o["a"])(i);try{var r=function(){var t=a.value,i=e.allData.findIndex((function(e){return e.detailid===t.detailid}));console.log(i),!0===t.checked&&-1!==i&&(e.allData[i].checked=!0)};for(n.s();!(a=n.n()).done;)r()}catch(d){n.e(d)}finally{n.f()}e.tablePage.total=t.data.length;var l=5*(e.tablePage.currentPage-1),s=l+5;e.tableData=e.allData.slice(l,s)}));case 2:case"end":return t.stop()}}),t)})))()},addProductEvent:function(e){var t=this;return Object(l["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.modalDisplay=!0,t.getProductList();case 2:case"end":return e.stop()}}),e)})))()},isDetailIdExists:function(e){var t,a=Object(o["a"])(this.shiptableData);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.detailid===e)return!0}}catch(n){a.e(n)}finally{a.f()}return!1},addProductListEvent:function(){var e,t=this,a=this.allData,i=Object(o["a"])(a);try{var n=function(){var a=e.value,i=t.shiptableData.findIndex((function(e){return e.detailid===a.detailid}));!0!==a.checked||t.shiptableData.find((function(e){return e.detailid===a.detailid}))?!1===a.checked&&t.shiptableData.find((function(e){return e.detailid===a.detailid}))&&t.shiptableData.splice(i,1):(a.shippingdetailid="",a.shipping_quantity="",t.shiptableData.push(a))};for(i.s();!(e=i.n()).done;)n()}catch(r){i.e(r)}finally{i.f()}this.modalDisplay=!1},deleteRowEvent:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){try{t.allData.find((function(t){return t.detailid===e.detailid})).checked=!1,t.tableData.find((function(t){return t.detailid===e.detailid})).checked=!1}finally{var a=t.shiptableData.findIndex((function(t){return t.detailid===e.detailid}));-1!==a&&t.shiptableData.splice(a,1);var i={action:"shipping_detail_table_view",subaction:"deleteRecord",idmap:{shippingdetailid:e.shippingdetailid},detailid:e.detailid,quantity:e.shipping_quantity};Object(u["a"])(i).then((function(e){d.a.modal.message({content:"删除成功",status:"success"})}))}}))},saveEvent:function(){var e=this,t=this.shiptableData.findIndex((function(e){return""===e.shipping_quantity||isNaN(e.shipping_quantity)}));if(-1===t){var a=this.shiptableData,i={action:"shipping_detail_table_view",subaction:"saveShippingInfoByEdit",shippingid:this.current_shippingid,shippinginfo:{shipping_address:this.modalForm.shipping_address,driver_name_id:this.modalForm.driver_name,customer_name_id:this.modalForm.customer_name,delivery_date:this.modalForm.delivery_date,username_id:this.modalForm.username},shippingdetailid_list:a.map((function(e){return{detailid:e.detailid,shippingdetailid:e.shippingdetailid,shipping_quantity:e.shipping_quantity,shipping_weight:e.shipping_weight,order_number_id:e.order_number_id}}))};console.log(i),Object(u["a"])(i).then((function(t){e.$router.back(),d.a.modal.message({content:"保存成功",status:"success"})}))}else d.a.modal.message({content:"发货数量不可为空,或者必须为数字。",status:"warning"})},gotoNextRow:function(e){var t=this,a=this.shiptableData.indexOf(e),i=a+1;if(i<this.shiptableData.length)this.$nextTick((function(){var e=0;e=0===a?14:14+10*a;var i=t.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[e];i&&i.click()}));else{var n=this.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[5];console.warn(n),n&&(console.warn("找到数据"),n.click(),n.focus()),console.warn("No next row available")}}}},h=m,f=a("2877"),_=Object(f["a"])(h,i,n,!1,null,"8d3da736",null);t["default"]=_.exports},"7db0":function(e,t,a){"use strict";var i=a("23e7"),n=a("b727").find,o=a("44d2"),r=a("ae40"),l="find",c=!0,s=r(l);l in[]&&Array(1)[l]((function(){c=!1})),i({target:"Array",proto:!0,forced:c||!s},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),o(l)},d96b:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var i=a("b775");function n(e){return Object(i["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/vue-element-admin/backend/download_file/",method:"get",params:e})}}}]);