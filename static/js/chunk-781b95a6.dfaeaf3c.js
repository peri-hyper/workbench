(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-781b95a6"],{"4b86":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("vxe-modal",{attrs:{title:e.uploadTitle,width:"390",resize:"","destroy-on-close":""},model:{value:e.modalUploadDisplay,callback:function(t){e.modalUploadDisplay=t},expression:"modalUploadDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"80"}},[a("vxe-form-item",{attrs:{title:"文件类型",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择文件类型"},model:{value:e.uploadData.file_type,callback:function(t){e.$set(e.uploadData,"file_type",t)},expression:"uploadData.file_type"}},[a("vxe-option",{attrs:{value:"1",label:"合同/订单"}}),a("vxe-option",{attrs:{value:"2",label:"图纸"}}),a("vxe-option",{attrs:{value:"3",label:"已签收发货单"}}),a("vxe-option",{attrs:{value:"4",label:"验焊报告"}}),a("vxe-option",{attrs:{value:"5",label:"质检报告"}}),a("vxe-option",{attrs:{value:"6",label:"镀锌报告"}}),a("vxe-option",{attrs:{value:"7",label:"其他"}})],1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"submit",status:"primary"},on:{click:function(t){e.modalUploadDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"},on:{click:e.manualUpload}},[e._v("上传附件")])],1)],1),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"","auto-upload":!1,"show-file-list":!0,action:"http://192.168.1.212:8000/vue-element-admin/backend/upload_file/",data:e.uploadData,"on-success":e.handleUploadSuccess,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])])],1),a("vxe-grid",e._b({ref:"xGrid",attrs:{"row-id":"order_number","highlight-current-row":"","checkbox-config":{highlight:!0,range:!0}},on:{"current-change":e.handleCurrentChange,"toggle-row-expand":e.handleToggleExpand,"cell-dblclick":e.queryFileHandle},scopedSlots:e._u([{key:"operation1",fn:function(t){var r=t.row;return[a("span",{domProps:{innerHTML:e._s(e.renderAOGStatus(r.order_status_label))}})]}},{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.ordersearchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{title:"全局搜索"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"请输入",clearable:"",filterable:""},on:{clear:e.WhenClear},model:{value:e.ordersearchFormData.search_data,callback:function(t){e.$set(e.ordersearchFormData,"search_data",t)},expression:"ordersearchFormData.search_data"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.ordersearchFormData.order_status,callback:function(t){e.$set(e.ordersearchFormData,"order_status",t)},expression:"ordersearchFormData.order_status"}},e._l(e.order_status_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary"},on:{click:e.addRow}},[e._v("新增订单")]),[a("vxe-button",{attrs:{status:"warning"},on:{click:e.queryDetailHandle}},[e._v("订单详情")]),a("vxe-button",{attrs:{status:"primary"},on:{click:e.editRowHandle}},[e._v("修改订单")]),a("vxe-button",{attrs:{status:"danger"},on:{click:e.deleteRowHandle}},[e._v("删除")]),a("vxe-button",{attrs:{status:"primary"},on:{click:e.uploadFileHandle}},[e._v("上传附件")]),a("vxe-button",{attrs:{status:"primary"},on:{click:e.queryFileHandle}},[e._v("查看附件")]),a("vxe-button",{attrs:{status:"primary"},on:{click:e.handleExportClick}},[e._v("导出Excel")])]]},proxy:!0},{key:"expandContent",fn:function(t){var r=t.row;return[a("div",{staticClass:"expand-container",staticStyle:{padding:"12px",background:"#f9fafb",border:"1px solid #ebeef5"}},[a("div",{staticStyle:{display:"flex",gap:"16px"}},[a("div",{staticStyle:{flex:"1","min-width":"480px"}},[a("h4",{staticClass:"mb-2"},[e._v("订单明细（订单号："+e._s(r.order_number)+"）")]),a("vxe-grid",{key:r._detailLoaded,ref:"gridDetail_"+r.order_number,attrs:{data:r._detail||[],columns:e.orderDetailcolumns,"highlight-current-row":"","keep-source":"",size:"mini","max-height":"360","show-overflow":""}})],1),a("div",{staticStyle:{flex:"1","min-width":"360px"}},[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("h4",{staticClass:"mr-2"},[e._v("附件列表")]),a("vxe-button",{staticStyle:{"margin-left":"15px"},attrs:{size:"mini",status:"primary"},on:{click:function(t){return e.batchDownload(r)}}},[e._v("批量下载")]),a("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(t){return e.openLocalFile()}}},[e._v("打开")]),a("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(t){return e.editFilename()}}},[e._v("编辑")]),a("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(t){return e.deletefile()}}},[e._v("删除")]),a("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(t){return e.download()}}},[e._v("下载")])],1),a("div",{ref:"dropZone",staticClass:"file-zone",staticStyle:{position:"relative"},on:{dragenter:function(t){return t.preventDefault(),e.onDragEnter(t,r)},dragover:function(e){e.preventDefault()},dragleave:function(t){return t.preventDefault(),e.onDragLeave(t)},drop:function(t){return t.preventDefault(),e.onDrop(t,r,e.rowIndex)}}},[a("transition",{attrs:{name:"fade"}},[e.dragging===r.order_number?a("div",{staticClass:"mask",staticStyle:{position:"absolute",inset:"0",background:"rgba(0,0,0,0.45)",color:"#fff","z-index":"10"}},[a("i",{staticClass:"el-icon-upload",staticStyle:{"font-size":"48px"}}),a("p",[e._v("松开鼠标上传文件")])]):e._e()]),a("vxe-grid",{key:r._attachLoaded,ref:"gridAttach_"+r.order_number,attrs:{data:r._attach||[],columns:e.attachmentColumns,"highlight-current-row":"","keep-source":"",size:"mini",height:"300","show-overflow":""},on:{"current-change":e.handleFileCurrentChange}})],1)])])])]}}])},"vxe-grid",e.gridOptions,!1),[e._v(" > ")]),a("vxe-modal",{attrs:{title:"新增",width:"560",resize:"","destroy-on-close":""},model:{value:e.modalDisplay,callback:function(t){e.modalDisplay=t},expression:"modalDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalSubmitEvent}},[a("vxe-form-item",{attrs:{title:"订单号码",span:24}},[a("vxe-input",{model:{value:e.modalForm.order_number,callback:function(t){e.$set(e.modalForm,"order_number",t)},expression:"modalForm.order_number"}})],1),a("vxe-form-item",{attrs:{title:"客户名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.customer_name_options,clearable:"",filterable:""},model:{value:e.modalForm.customer_name_id,callback:function(t){e.$set(e.modalForm,"customer_name_id",t)},expression:"modalForm.customer_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"项目名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.project_name_options,clearable:"",filterable:""},model:{value:e.modalForm.project_name,callback:function(t){e.$set(e.modalForm,"project_name",t)},expression:"modalForm.project_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"订单日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalForm.order_date,callback:function(t){e.$set(e.modalForm,"order_date",t)},expression:"modalForm.order_date"}})],1),a("vxe-form-item",{attrs:{title:"开始生产日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalForm.manufacture_date,callback:function(t){e.$set(e.modalForm,"manufacture_date",t)},expression:"modalForm.manufacture_date"}})],1),a("vxe-form-item",{attrs:{title:"预出货日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalForm.delivery_date,callback:function(t){e.$set(e.modalForm,"delivery_date",t)},expression:"modalForm.delivery_date"}})],1),a("vxe-form-item",{attrs:{title:"订单内容",span:24}},[a("vxe-input",{model:{value:e.modalForm.order_details,callback:function(t){e.$set(e.modalForm,"order_details",t)},expression:"modalForm.order_details"}})],1),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalForm.remarks,callback:function(t){e.$set(e.modalForm,"remarks",t)},expression:"modalForm.remarks"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("vxe-modal",{attrs:{title:"编辑",width:"600",resize:"","destroy-on-close":""},model:{value:e.modalEditDisplay,callback:function(t){e.modalEditDisplay=t},expression:"modalEditDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalEditSubmitEvent}},[a("vxe-form-item",{attrs:{title:"订单号码",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.order_number,callback:function(t){e.$set(e.modalEditForm,"order_number",t)},expression:"modalEditForm.order_number"}})],1),a("vxe-form-item",{attrs:{title:"客户名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.customer_name_options,clearable:"",filterable:""},model:{value:e.modalEditForm.customer_name_id,callback:function(t){e.$set(e.modalEditForm,"customer_name_id",t)},expression:"modalEditForm.customer_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"项目名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.project_name_options,clearable:"",filterable:""},model:{value:e.modalEditForm.project_name,callback:function(t){e.$set(e.modalEditForm,"project_name",t)},expression:"modalEditForm.project_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"订单日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalEditForm.order_date,callback:function(t){e.$set(e.modalEditForm,"order_date",t)},expression:"modalEditForm.order_date"}})],1),a("vxe-form-item",{attrs:{title:"开始生产日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalEditForm.manufacture_date,callback:function(t){e.$set(e.modalEditForm,"manufacture_date",t)},expression:"modalEditForm.manufacture_date"}})],1),a("vxe-form-item",{attrs:{title:"预出货日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalEditForm.delivery_date,callback:function(t){e.$set(e.modalEditForm,"delivery_date",t)},expression:"modalEditForm.delivery_date"}})],1),a("vxe-form-item",{attrs:{title:"上单日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalEditForm.invoice_date,callback:function(t){e.$set(e.modalEditForm,"invoice_date",t)},expression:"modalEditForm.invoice_date"}})],1),a("vxe-form-item",{attrs:{title:"订单内容",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.order_details,callback:function(t){e.$set(e.modalEditForm,"order_details",t)},expression:"modalEditForm.order_details"}})],1),a("vxe-form-item",{attrs:{title:"订单状态",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalEditForm.order_status,callback:function(t){e.$set(e.modalEditForm,"order_status",t)},expression:"modalEditForm.order_status"}},e._l(e.order_status_options2,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.remarks,callback:function(t){e.$set(e.modalEditForm,"remarks",t)},expression:"modalEditForm.remarks"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalEditDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1)],1)},n=[],o=a("2909"),i=a("3835"),l=a("b85c"),s=a("c7eb"),c=a("1da1"),d=a("5530"),u=(a("99af"),a("4de4"),a("7db0"),a("a630"),a("caad"),a("d81d"),a("fb6a"),a("a434"),a("b0c0"),a("e9c4"),a("b680"),a("c1f9"),a("b64b"),a("d3b7"),a("4d63"),a("ac1f"),a("2c3e"),a("25f0"),a("2532"),a("3ca3"),a("5319"),a("0643"),a("2382"),a("fffc"),a("4e3e"),a("a573"),a("159b"),a("ddb0"),a("5c96")),m=a("a388"),p=a("d96b"),f=a("2f62"),b="O:\\producterp\\producterp\\attachments\\ordertable\\",h="http://127.0.0.1:3210",v={computed:Object(d["a"])({},Object(f["b"])(["sidebar","avatar","device","name","ordersearchFormData","select_row_number","list_scroll_top","list_current_page","expanded_rows","scroll_row_key"])),data:function(){var e=this;return{filecurrentRow:null,dragging:null,isTableReady:!1,checkboxCol:null,isSelectMode:!1,attachCache:Object.create(null),currentRow:null,FileListModalView:!1,bodySelector:".vxe-table--body-wrapper",uploadTitle:"上传附件",modalUploadDisplay:!1,extra_order_number:"",extra_customer_name_id:"",uploadData:{},order_status_options:[{label:"待发货",value:1},{label:"已发货",value:2}],order_status_options2:[{label:"生产中",value:1},{label:"已暂停",value:0},{label:"已完成",value:2}],selectoptions:{},modalDisplay:!1,modalForm:{},modalEditDisplay:!1,modalEditForm:{},gridOptions:{resizable:!0,showOverflow:!0,height:1100,rowheight:25,border:"inner",rowId:"id",rowConfig:{isHover:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:80,pageSizes:[80,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page;t.sorts,t.filters;e.ordersearchFormData.username=e.name;var r={action:"order_table_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.ordersearchFormData};return Object(p["b"])(r)}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"checkbox",width:120,align:"center",showOverflow:!1,range:!0,highlight:!0,visible:!1},{type:"seq",title:"序号",width:60,align:"center"},{type:"expand",width:40,align:"center",showOverflow:!1,className:"bg-white pl-2",slots:{content:"expandContent"}},{field:"orderid",title:"ID",visible:!1},{field:"customer_name_id",title:"客户名称",sortable:!0,width:250},{field:"order_number",title:"订单号码",sortable:!0,width:250},{field:"project_name",title:"项目名称",sortable:!0,width:160},{field:"order_date",title:"订单日期",sortable:!0,align:"center"},{field:"manufacture_date",title:"开始日期",sortable:!0,align:"center"},{field:"delivery_date",title:"预出货日期",sortable:!0,align:"center"},{field:"invoice_date",title:"对账日期",visible:!1,align:"center"},{field:"order_status",title:"订单状态",visible:!1,align:"center"},{field:"order_details",title:"订单内容",sortable:!0,align:"center"},{title:"生产状态",showOverflow:!0,fixed:"right",slots:{default:"operation1"},sortable:!0,align:"center"},{field:"remarks",title:"备注",align:"center"},{field:"username_id",title:"跟单员",sortable:!0,align:"center"}]},orderDetailcolumns:[{type:"seq",title:"序号",width:60,align:"center"},{field:"commodity_details",title:"品名",sortable:!0,align:"center"},{field:"commodity_size",title:"规格",sortable:!0,align:"center"},{field:"control_no",title:"编号",sortable:!0,align:"center"},{field:"commodity_units",title:"单位",align:"center"},{field:"commodity_quantity",title:"库存数量",align:"center"},{field:"total_shipping_quantity",title:"已出货数量",align:"center"},{field:"unit_weight",title:"单件重量",align:"center"},{field:"commodity_weight",title:"重量",align:"center"},{field:"remarks",title:"备注",align:"center"}],attachmentColumns:[{type:"checkbox",width:60},{type:"seq",width:50,title:"#"},{field:"filename",title:"文件名",showOverflow:!0},{field:"object_id",title:"object_id",visible:!1},{field:"stored_name",title:"object_id",visible:!1},{field:"file_size",title:"大小",align:"center",formatter:function(e){var t=e.cellValue;return null==t||""===t?"":(t/1048576).toFixed(2)+" MB"}},{field:"upload_time",title:"上传时间",width:160,align:"center"}]}},created:function(){},mounted:function(){var e=this;this.getOptions(),this.checkboxCol=this.gridOptions.columns.find((function(e){return"checkbox"===e.type})),this.$refs.xGrid.commitProxy("query").then((function(){e.$nextTick((function(){return setTimeout(e.autoRecover,200)}))}))},methods:{refreshAttach:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(p["b"])({action:"attachment_file_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{model:"app.OrderTable",orderid:e.orderid}});case 2:r=a.sent,t.$set(e,"_attach",r.data||[]),t.$set(e,"_attachLoaded",Date.now());case 5:case"end":return a.stop()}}),a)})))()},handleExceed:function(){this.$message.warning("最多只能上传 ".concat(this.maxCount===1/0?"不限":this.maxCount+" 件"," 附件"))},onDragEnter:function(e,t){this.dragging=t.order_number},onDragLeave:function(e){e.currentTarget.contains(e.relatedTarget)||(this.dragging=null)},onDrop:function(e,t){var a=this;return Object(c["a"])(Object(s["a"])().mark((function r(){var n,o,i,c,d,u,f,b,h,v,_,x;return Object(s["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a.dragging=null,n=Array.from(e.dataTransfer.files||[]),o=n.filter((function(e){return!(""===e.type&&0===e.size)})),o.length){r.next=6;break}return a.$message.warning("未检测到有效文件（或不支持文件夹拖入）"),r.abrupt("return");case 6:i=t.orderid,c=t._attach||[],d=Object.fromEntries(c.map((function(e){return[e.filename,e]}))),u=[],f=[],b=Object(l["a"])(o),r.prev=12,b.s();case 14:if((h=b.n()).done){r.next=32;break}if(v=h.value,_=d[v.name],!_){r.next=29;break}return r.prev=18,r.next=21,a.$confirm("文件 “".concat(v.name,"” 已存在，是否覆盖？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0});case 21:u.push(_.attachmentid),f.push(v),r.next=27;break;case 25:r.prev=25,r.t0=r["catch"](18);case 27:r.next=30;break;case 29:f.push(v);case 30:r.next=14;break;case 32:r.next=37;break;case 34:r.prev=34,r.t1=r["catch"](12),b.e(r.t1);case 37:return r.prev=37,b.f(),r.finish(37);case 40:if(f.length){r.next=43;break}return a.$message.info("所有文件均已取消或与现有重复，无需上传"),r.abrupt("return");case 43:if(!u.length){r.next=46;break}return r.next=46,Object(p["b"])({action:"attachment_file_view",subaction:"bulk_delete",ids:u});case 46:return x=new FormData,x.append("action","attachment_file_view"),x.append("subaction","add"),x.append("searchForm",JSON.stringify({model:"app.OrderTable",pk:i})),f.forEach((function(e){return x.append("files",e)})),r.next=53,Object(p["b"])(x,{headers:{"Content-Type":"multipart/form-data"}});case 53:return r.next=55,a.refreshAttach(t);case 55:m["VXETable"].modal.message({content:"上传成功",status:"success"});case 56:case"end":return r.stop()}}),r,null,[[12,34,37,40],[18,25]])})))()},withLoading:function(e){var t=u["Loading"].service({lock:!0,text:"生成中，请稍候…",background:"rgba(0, 0, 0, 0.4)"});return e().finally((function(){return t.close()}))},handleExportClick:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isSelectMode){t.next=5;break}return e.isSelectMode=!0,e.toggleCheckboxColumn(!0),e.$nextTick((function(){return e.$refs.xGrid.clearCheckboxRow()})),t.abrupt("return");case 5:return t.next=7,e.exportSelectedExcel();case 7:case"end":return t.stop()}}),t)})))()},toggleCheckboxColumn:function(e){var t=this.$refs.xGrid.getTableColumn(),a=t.fullColumn,r=a.find((function(e){return"checkbox"===e.type}));r&&(e?this.$refs.xGrid.showColumn(r):this.$refs.xGrid.hideColumn(r))},exportSelectedExcel:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){var a,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$refs.xGrid.getCheckboxRecords(),a.length){t.next=6;break}return e.isSelectMode=!1,e.$refs.xGrid.clearCheckboxRow(),e.toggleCheckboxColumn(!1),t.abrupt("return",e.$message.warning("请先勾选要导出的行"));case 6:r=a.map((function(e){return e.orderid})),e.withLoading(Object(c["a"])(Object(s["a"])().mark((function e(){var t,a,n;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={action:"order_table_view",subaction:"export_excel",ids:r},e.next=3,Object(p["b"])(t);case 3:if(a=e.sent,0===a.code){e.next=6;break}throw new Error(a.msg||"导出失败");case 6:return e.next=8,Object(p["c"])({order_excel:a.order_excel});case 8:n=e.sent,m["VXETable"].saveFile({filename:"订单_".concat((new Date).toISOString().slice(0,10)),type:n.headers["my_file_type"],content:n.data});case 10:case"end":return e.stop()}}),e)})))).catch((function(t){return e.$message.error(t.message||"导出失败")})).finally((function(){e.isSelectMode=!1,e.$refs.xGrid.clearCheckboxRow(),e.toggleCheckboxColumn(!1)}));case 8:case"end":return t.stop()}}),t)})))()},batchDownload:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r,n,o;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.$refs["gridAttach_"+e.order_number],n=r.getCheckboxRecords(),n.length){a.next=5;break}return m["VXETable"].modal.message({content:"请先勾选要下载的附件",status:"warning"}),a.abrupt("return");case 5:o=n.map((function(e){return e.attachmentid})),t.withLoading(Object(c["a"])(Object(s["a"])().mark((function a(){var r,n;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(p["a"])({action:"attachment_file_view",subaction:"batch_download",ids:o},{responseType:"blob",timeout:0});case 3:r=a.sent,n=e.order_number?"附件 ".concat(e.order_number):"attachments.zip",m["VXETable"].saveFile({filename:n,type:"zip",content:r.data}),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](0),t.$message.error("下载失败");case 11:case"end":return a.stop()}}),a,null,[[0,8]])}))));case 7:case"end":return a.stop()}}),a)})))()},openLocalFile:function(){var e=arguments,t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r,n,o,l,c,d,p,f,v,_,x,g,w;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.length>0&&void 0!==e[0]&&e[0],n=t.getSelectedFileRow(),o=n.new_filename||n.filename,o){a.next=6;break}return m["VXETable"].modal.message({content:"记录里没有文件名",status:"error"}),a.abrupt("return");case 6:return l=u["Loading"].service({lock:!0,text:"文件打开中…",spinner:"el-icon-loading",background:"rgba(0,0,0,0.15)"}),c=b+n.object_id+"\\"+o,t.lastOpenedPath=r?"":c,a.prev=9,p=500,a.next=13,Promise.all([fetch("".concat(h,"/open"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:c,readonly:r,user:(null===(d=t.$store)||void 0===d?void 0:d.state.userName)||"LiLin"})}),new Promise((function(e){return setTimeout(e,p)}))]);case 13:if(f=a.sent,v=Object(i["a"])(f,1),_=v[0],200!==_.status){a.next=18;break}return a.abrupt("return");case 18:if(423!==_.status){a.next=27;break}return a.next=21,_.json();case 21:return x=a.sent,g=x.lock_info,w="".concat(g.user," @ ").concat(g.host," 正在编辑。\n要只读打开吗？"),a.next=26,t.$confirm(w,"文件被占用",{confirmButtonText:"只读打开",cancelButtonText:"取消",type:"warning"});case 26:return a.abrupt("return",t.openLocalFile(n,!0));case 27:return a.t0=Error,a.next=30,_.text();case 30:throw a.t1=a.sent,new a.t0(a.t1);case 34:a.prev=34,a.t2=a["catch"](9),m["VXETable"].modal.message({content:"打开失败："+(a.t2.message||"请检查本地助手是否已启动"),status:"error"});case 37:return a.prev=37,l.close(),a.finish(37);case 40:case"end":return a.stop()}}),a,null,[[9,34,37,40]])})))()},releaseLock:function(){this.lastOpenedPath&&fetch("".concat(h,"/release"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:this.lastOpenedPath})}).catch((function(){}))},handleToggleExpand:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r,n,o,i;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.row,n=e.expanded,n){a.next=3;break}return a.abrupt("return");case 3:if(r._detail){a.next=9;break}return a.next=6,Object(p["b"])({action:"order_detail_table_view",subaction:"query",pageNum:1,pageSize:1500,searchForm:{username:t.name,order_number:r.order_number}});case 6:o=a.sent,t.$set(r,"_detail",o.data||[]),t.$set(r,"_detailLoaded",Date.now());case 9:if(r._attach){a.next=15;break}return a.next=12,Object(p["b"])({action:"attachment_file_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{model:"app.OrderTable",orderid:r.orderid}});case 12:i=a.sent,t.$set(r,"_attach",i.data||[]),t.$set(r,"_attachLoaded",Date.now());case 15:case"end":return a.stop()}}),a)})))()},handleCurrentChange:function(e){var t=e.row;this.currentRow=t},handleFileCurrentChange:function(e){var t=e.row;this.filecurrentRow=t},getSelectedRow:function(){return this.currentRow?this.currentRow:(m["VXETable"].modal.message({content:"请先单击选择一行",status:"warning"}),null)},getSelectedFileRow:function(){return this.filecurrentRow?this.filecurrentRow:(m["VXETable"].modal.message({content:"请先单击选择一行",status:"warning"}),null)},editRowHandle:function(){var e=this.getSelectedRow();e&&this.editRow(e)},deleteRowHandle:function(){var e=this.getSelectedRow();e&&this.deleteRow(e)},uploadFileHandle:function(){var e=this.getSelectedRow();e&&this.uploadFileRow(e)},queryFileHandle:function(){var e=this,t=this.getSelectedRow();if(t){var a=this.$refs.xGrid,r=!a.isExpandByRow(t);a.toggleRowExpand(t,r),this.$nextTick((function(){e.handleToggleExpand({row:t,expanded:r})}))}},queryDetailHandle:function(){var e=this.getSelectedRow();e&&this.queryDetailRow(e)},renderAOGStatus:function(e){var t;switch(e){case"生产中":t="#409EFF";break;case"已暂停":t="#FFA500";break;case"已完成":t="#24ff33";break;default:t="black"}return'<span style="font-weight:bold; color:'.concat(t,';">').concat(e,"</span>")},WhenClear:function(){this.ordersearchFormData={}},getOptions:function(){var e=this,t={action:"order_table_view",subaction:"getOptions"};Object(p["b"])(t).then((function(t){e.selectoptions=t.data}))},addRow:function(){console.log(111),this.modalForm={},this.modalDisplay=!0,console.log(this.modalDisplay)},modalSubmitEvent:function(){var e=this;this.modalForm.username_id=this.name;var t={action:"order_table_view",subaction:"addRecord",modalForm:this.modalForm};Object(p["b"])(t).then((function(t){e.modalDisplay=!1,m["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},deleteRow:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){var a=t.$refs.xGrid.$data["tableData"];for(var r in a)e.id===a[r].id&&a.splice(r,1);var n={action:"order_table_view",subaction:"deleteRecord",idmap:{order_number:e.order_number},order_number:e.order_number};Object(p["b"])(n).then((function(e){m["VXETable"].modal.message({content:"删除成功",status:"success"}),t.$refs.xGrid.commitProxy("reload")}))}))},editRow:function(e){this.modalEditDisplay=!0,this.modalEditForm=e,this.modalEditForm.old_order_number=e.order_number;var t=a("2ef0");this.modalEditForm=t.cloneDeep(e),delete this.modalEditForm.id,delete this.modalEditForm.order_status_label},modalEditSubmitEvent:function(){var e=this,t={action:"order_table_view",subaction:"editRecord",modalEditForm:this.modalEditForm,idmap:{orderid:this.modalEditForm.orderid}};Object(p["b"])(t).then((function(t){e.modalEditDisplay=!1,m["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},resetEvent:function(){var e=this.ordersearchFormData;Object.keys(e).forEach((function(t){"search_data"===t&&(e[t]="")})),this.$refs.xGrid.commitProxy("reload")},handleUploadSuccess:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function e(){var a,r,n,i,l;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(m["VXETable"].modal.message({content:"上传成功",status:"success"}),a=t.extra_order_number,a){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(p["b"])({action:"file_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{order_number:a}});case 7:r=e.sent,n=Array.isArray(r.data)?Object(o["a"])(r.data):[],t.$set(t.attachCache,a,Object(o["a"])(n)),i=t.$refs.xGrid,l=i.getTableData().fullData,l.filter((function(e){return e.order_number===a})).forEach((function(e){t.$set(e,"_files",Object(o["a"])(n))})),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](4),console.error("更新文件失败:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))()},uploadFileRow:function(e){this.extra_order_number=e.order_number,this.extra_customer_name_id=e.customer_name_id,this.uploadTitle="上传订单 ".concat(e.order_number," 的附件"),this.modalUploadDisplay=!0},updateUploadData:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.uploadData.order_number=e.extra_order_number,e.uploadData.customer_name_id=e.extra_customer_name_id,console.log(e.uploadData);case 3:case"end":return t.stop()}}),t)})))()},afterUpload:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.updateUploadData().then((function(){e.$refs.upload.submit()}));case 1:case"end":return t.stop()}}),t)})))()},manualUpload:function(){var e=this;this.uploadData.file_type?(this.afterUpload().then((function(){e.modalUploadDisplay=!1,e.uploadData={},e.getUploadFileList(e.extra_order_number)})),this.file_order_number=this.extra_order_number):m["VXETable"].modal.message({content:"请选择文件类型",status:"error"})},getUploadFileList:function(e){var t=this;this.file_order_number=this.extra_order_number;var a={action:"file_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{order_number:e}};Object(p["b"])(a).then((function(e){t.gridOptionsExtra.data=e.data}))},deleteFileRow:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r,n,i,l,c;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$confirm("此操作将永久删除该附件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0});case 2:return a.prev=2,a.next=5,Object(p["b"])({action:"file_table_view",subaction:"deleteRecord",idmap:{fileid:e.fileid}});case 5:if(r=e.order_number_id,r){a.next=8;break}return a.abrupt("return");case 8:return a.next=10,Object(p["b"])({action:"file_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{order_number:r}});case 10:n=a.sent,i=Array.isArray(n.data)?Object(o["a"])(n.data):[],t.$set(t.attachCache,r,i),l=t.$refs.xGrid,c=l.getTableData().fullData,c.filter((function(e){return e.order_number===r})).forEach((function(e){t.$set(e,"_files",Object(o["a"])(i))})),m["VXETable"].modal.message({content:"删除成功",status:"success"}),a.next=22;break;case 19:a.prev=19,a.t0=a["catch"](2),console.error("删除失败:",a.t0);case 22:case"end":return a.stop()}}),a,null,[[2,19]])})))()},download:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){var a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.getSelectedFileRow(),a){t.next=3;break}return t.abrupt("return");case 3:e.withLoading(Object(c["a"])(Object(s["a"])().mark((function e(){var t,r,n;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(p["a"])({action:"attachment_file_view",subaction:"download",id:a.attachmentid},{responseType:"blob",noCodeCheck:!0});case 2:t=e.sent,r=a.filename.split(".").pop(),n=a.filename.replace(new RegExp("\\.".concat(r,"$"),"i"),""),m["VXETable"].saveFile({filename:n,type:r,content:t.data});case 6:case"end":return e.stop()}}),e)})))).catch((function(){e.$message.error("下载失败")}));case 4:case"end":return t.stop()}}),t)})))()},queryDetailRow:function(e){var t=this.$refs.xGrid.getRowIndex(e);this.$store.commit("SET_SELECT_ROW",t),this.$store.commit("SET_SCROLL_ROW_KEY",e.order_number);var a=this.$refs.xGrid.getProxyInfo().pager;this.$store.commit("SET_CURRENT_PAGE",a.currentPage);var r=this.$refs.xGrid.$el.querySelector(".vxe-table--body-wrapper"),n=r?r.scrollTop:0;this.$store.commit("SET_SCROLL_TOP",n);var o=this.$refs.xGrid,i=o.getRowExpandRecords(),l=i.map((function(e){return e.order_number}));this.$store.commit("SET_EXPANDED_ROWS",l),console.log("[Save] index=",t," scroll=",n),this.$router.push({path:"/erporder/order_detail_table_view",query:{order_number:e.order_number,customer_name_id:e.customer_name_id,username:this.name}})},autoRecover:function(){var e=this;return Object(c["a"])(Object(s["a"])().mark((function t(){var a,r,n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.list_current_page,r=e.$refs.xGrid,null==a){t.next=8;break}return n=r.getProxyInfo(),n&&n.pager&&(n.pager.currentPage=a),t.next=7,r.commitProxy("query");case 7:e.$store.commit("SET_CURRENT_PAGE",null);case 8:e.$nextTick(Object(c["a"])(Object(s["a"])().mark((function t(){var a,r,n,o,i,c,d;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.$refs.xGrid,r=a.getTableData().fullData,n=r.filter((function(t){return e.expanded_rows.includes(t.order_number)})),o=Object(l["a"])(n);try{for(o.s();!(i=o.n()).done;)c=i.value,e.loadExpandData(c),a.setRowExpand(c,!0)}catch(s){o.e(s)}finally{o.f()}if(null==e.list_scroll_top){t.next=12;break}return t.next=8,e.$nextTick((function(){var t=e.$refs.xGrid;t.refreshScroll()}));case 8:return t.next=10,new Promise((function(e){return setTimeout(e,0)}));case 10:return t.next=12,new Promise((function(t,a){var r=e.$refs.xGrid;r.scrollTo(null,e.list_scroll_top).then(t).catch(a)}));case 12:null!=e.select_row_number&&(d=r[e.select_row_number],d&&a.setCurrentRow(d),e.currentRow=d),e.$store.commit("SET_EXPANDED_ROWS",[]),e.$store.commit("SET_SCROLL_TOP",null),e.$store.commit("SET_SELECT_ROW",null);case 16:case"end":return t.stop()}}),t)}))));case 9:case"end":return t.stop()}}),t)})))()},loadExpandData:function(e){var t=this;return Object(c["a"])(Object(s["a"])().mark((function a(){var r,n,i;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.order_number,!t.attachCache[r]){a.next=4;break}return t.$set(e,"_files",Object(o["a"])(t.attachCache[r])),a.abrupt("return");case 4:return a.next=6,Object(p["b"])({action:"file_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{order_number:r}});case 6:n=a.sent,i=Array.isArray(n.data)?n.data:[],t.$set(t.attachCache,r,i),t.$set(e,"_files",i);case 10:case"end":return a.stop()}}),a)})))()}}},_=v,x=(a("fd5f"),a("2877")),g=Object(x["a"])(_,r,n,!1,null,null,null);t["default"]=g.exports},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,o=a("44d2"),i=a("ae40"),l="find",s=!0,c=i(l);l in[]&&Array(1)[l]((function(){s=!1})),r({target:"Array",proto:!0,forced:s||!c},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),o(l)},"87ac":function(e,t,a){},c1f9:function(e,t,a){var r=a("23e7"),n=a("2266"),o=a("8418");r({target:"Object",stat:!0},{fromEntries:function(e){var t={};return n(e,(function(e,a){o(t,e,a)}),void 0,!0),t}})},d96b:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return l}));var r=a("5530"),n=a("b775");function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/process/"),method:"post",data:e,timeout:5e3},t))}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/download_file/"),method:"get",params:e,responseType:"blob",timeout:0},t))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e,responseType:"blob",noCodeCheck:!0,timeout:0},t))}},e9c4:function(e,t,a){var r=a("23e7"),n=a("d066"),o=a("d039"),i=n("JSON","stringify"),l=/[\uD800-\uDFFF]/g,s=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,d=function(e,t,a){var r=a.charAt(t-1),n=a.charAt(t+1);return s.test(e)&&!c.test(n)||c.test(e)&&!s.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},u=o((function(){return'"\\udf06\\ud834"'!==i("\udf06\ud834")||'"\\udead"'!==i("\udead")}));i&&r({target:"JSON",stat:!0,forced:u},{stringify:function(e,t,a){var r=i.apply(null,arguments);return"string"==typeof r?r.replace(l,d):r}})},fd5f:function(e,t,a){"use strict";a("87ac")},fffc:function(e,t,a){"use strict";var r=a("23e7"),n=a("2266"),o=a("1c0b"),i=a("825a");r({target:"Iterator",proto:!0,real:!0},{find:function(e){return i(this),o(e),n(this,(function(t){if(e(t))return n.stop(t)}),void 0,!1,!0).result}})}}]);