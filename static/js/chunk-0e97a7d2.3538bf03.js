(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e97a7d2"],{"5ec5":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{padding:"0 50px 0 50px"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDivVisible,expression:"isDivVisible"}]},[i("h4",[t._v("您正在编辑发货单："+t._s(t.current_shippingid))]),i("vxe-toolbar",{scopedSlots:t._u([{key:"buttons",fn:function(){return[i("vxe-button",{attrs:{icon:"vxe-icon-square-plus",status:"primary"},on:{click:t.addProductEvent}},[t._v("添加产品")]),i("vxe-button",{attrs:{icon:"vxe-icon-save",status:"primary"},on:{click:t.saveEvent}},[t._v("保存")])]},proxy:!0}])}),i("vxe-form",{staticStyle:{"margin-left":"-10px"},attrs:{"title-align":"right","title-width":"100"}},[i("vxe-form-item",{attrs:{title:"客户名称",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:t.modalForm.customer_name,callback:function(e){t.$set(t.modalForm,"customer_name",e)},expression:"modalForm.customer_name"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"出货日期",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:t.modalForm.delivery_date,callback:function(e){t.$set(t.modalForm,"delivery_date",e)},expression:"modalForm.delivery_date"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"收货地址",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-select",{attrs:{placeholder:"请搜索",options:t.shipping_options.shipping_address_options,clearable:"",filterable:""},on:{change:t.getProjectInfo},model:{value:t.modalForm.shipping_address,callback:function(e){t.$set(t.modalForm,"shipping_address",e)},expression:"modalForm.shipping_address"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"司机",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-select",{attrs:{placeholder:"请搜索",options:t.shipping_options.driver_name_options,clearable:"",filterable:""},on:{change:t.getDriverInfo},model:{value:t.modalForm.driver_name,callback:function(e){t.$set(t.modalForm,"driver_name",e)},expression:"modalForm.driver_name"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"发货人",span:4},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-select",{attrs:{placeholder:"请搜索",options:t.shipping_options.username_options,clearable:"",filterable:""},model:{value:t.modalForm.username,callback:function(e){t.$set(t.modalForm,"username",e)},expression:"modalForm.username"}})]},proxy:!0}])})],1),i("vxe-form",{staticStyle:{"margin-left":"-10px"},attrs:{"title-align":"right","title-width":"100"}},[i("vxe-form-item",{attrs:{title:"收货人",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:t.modalForm.project_contact_name,callback:function(e){t.$set(t.modalForm,"project_contact_name",e)},expression:"modalForm.project_contact_name"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"收货联系方式",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:t.modalForm.project_contact_phone,callback:function(e){t.$set(t.modalForm,"project_contact_phone",e)},expression:"modalForm.project_contact_phone"}})]},proxy:!0}])}),i("vxe-form-item",{attrs:{title:"车牌",span:5},scopedSlots:t._u([{key:"default",fn:function(){return[i("vxe-input",{attrs:{placeholder:"",disabled:""},model:{value:t.modalForm.licence_plate,callback:function(e){t.$set(t.modalForm,"licence_plate",e)},expression:"modalForm.licence_plate"}})]},proxy:!0}])})],1),i("vxe-table",{ref:"xTable",attrs:{border:"","show-overflow":"","keep-source":"","max-height":"400",data:t.shiptableData,"edit-config":{trigger:"click",mode:"cell",icon:"vxe-icon-edit",showStatus:!0}}},[i("vxe-column",{attrs:{type:"seq",width:"60",title:"序号"}}),i("vxe-column",{attrs:{field:"detailid",title:"产品编号",visible:!1},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.detailid,callback:function(e){t.$set(n,"detailid",e)},expression:"row.detailid"}})]}}])}),i("vxe-column",{attrs:{field:"order_number_id",title:"订单编号"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.order_number_id,callback:function(e){t.$set(n,"order_number_id",e)},expression:"row.order_number_id"}})]}}])}),i("vxe-column",{attrs:{field:"commodity_details",title:"品名"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.commodity_details,callback:function(e){t.$set(n,"commodity_details",e)},expression:"row.commodity_details"}})]}}])}),i("vxe-column",{attrs:{field:"commodity_size",title:"规格"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.commodity_size,callback:function(e){t.$set(n,"commodity_size",e)},expression:"row.commodity_size"}})]}}])}),i("vxe-column",{attrs:{field:"control_no",title:"编号"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.control_no,callback:function(e){t.$set(n,"control_no",e)},expression:"row.control_no"}})]}}])}),i("vxe-column",{attrs:{field:"commodity_units",title:"单位"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.commodity_units,callback:function(e){t.$set(n,"commodity_units",e)},expression:"row.commodity_units"}})]}}])}),i("vxe-column",{attrs:{field:"shipping_quantity",title:"发货数量","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},on:{change:function(e){return t.handleChange(n)}},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnterUp(n)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:t.onDownUp(n)}]},model:{value:n.shipping_quantity,callback:function(e){t.$set(n,"shipping_quantity",e)},expression:"row.shipping_quantity"}})]}}])}),i("vxe-column",{attrs:{field:"shipping_weight",title:"发货重量"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.shipping_weight,callback:function(e){t.$set(n,"shipping_weight",e)},expression:"row.shipping_weight"}})]}}])}),i("vxe-column",{attrs:{field:"unit_weight",title:"单件重量"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.unit_weight,callback:function(e){t.$set(n,"unit_weight",e)},expression:"row.unit_weight"}})]}}])}),i("vxe-column",{attrs:{field:"commodity_quantity",title:"库存数量"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.commodity_quantity,callback:function(e){t.$set(n,"commodity_quantity",e)},expression:"row.commodity_quantity"}})]}}])}),i("vxe-column",{attrs:{field:"备注",title:"备注"},scopedSlots:t._u([{key:"edit",fn:function(e){var n=e.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:n.remarks,callback:function(e){t.$set(n,"remarks",e)},expression:"row.remarks"}})]}}])}),i("vxe-column",{attrs:{title:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[i("vxe-button",{attrs:{status:"danger",content:"删除"},on:{click:function(e){return t.deleteRowEvent(n)}}})]}}])})],1),i("vxe-modal",{attrs:{title:"选择产品",width:"800",resize:"","destroy-on-close":""},model:{value:t.modalDisplay,callback:function(e){t.modalDisplay=e},expression:"modalDisplay"}},[i("div",{staticStyle:{"text-align":"center","margin-top":"10px","margin-bottom":"10px"}},[i("vxe-input",{attrs:{type:"search",placeholder:"全局搜索"},on:{keyup:t.searchEvent},model:{value:t.searchOrderNumber,callback:function(e){t.searchOrderNumber=e},expression:"searchOrderNumber"}})],1),i("vxe-table",{ref:"xTableOrders",attrs:{data:t.list,size:"small","show-overflow":"",height:"500","checkbox-config":{trigger:"row",highlight:!0,range:!0,checkField:"checked"}},on:{"checkbox-change":t.handleCheckboxChange,"checkbox-all":t.handleCheckAll}},[i("vxe-column",{attrs:{type:"checkbox",title:"选择",width:"80"}}),i("vxe-column",{attrs:{field:"commodity_details",title:"品名"}}),i("vxe-column",{attrs:{field:"order_number_id",title:"订单号码"}}),i("vxe-column",{attrs:{field:"commodity_size",title:"规格"}}),i("vxe-column",{attrs:{field:"control_no",title:"编号"}}),i("vxe-column",{attrs:{field:"commodity_quantity",title:"库存数量"}})],1),i("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[i("vxe-button",{attrs:{status:"primary",content:"确认"},on:{click:t.addProductListEvent}})],1)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDivVisible,expression:"!isDivVisible"}]},[i("h4",[t._v("提示：请先到发货单管理菜单选择要编辑的发货单。")])])])},a=[],o=i("c7eb"),r=i("1da1"),s=i("b85c"),c=i("5530"),l=(i("4de4"),i("7db0"),i("c740"),i("d81d"),i("a434"),i("b0c0"),i("b680"),i("d3b7"),i("4d63"),i("ac1f"),i("2c3e"),i("25f0"),i("5319"),i("498a"),i("a388")),d=i.n(l),u=i("d96b"),p=i("2f62"),m=i("c695"),h=i.n(m),f={computed:Object(c["a"])({},Object(p["b"])(["sidebar","avatar","device","name"])),data:function(){return{selectoptions:{},tablePage:{total:0,currentPage:1,pageSize:5},checkboxConfig:{reserve:!0},isDivVisible:!1,current_shippingid:"",shipping_options:{},modalForm:{project_contact_name:"",shipping_address:"",project_contact_phone:"",driver_name:"",customer_name:"",delivery_date:"",licence_plate:"",username:"",order_number_id:""},searchOrderNumber:"",modalDisplay:!1,list:[],tableData:[],shiptableData:[]}},watch:{modalForm:function(t){console.log("modalForm updated:",t)}},created:function(){this.current_shippingid=this.$route.query.shippingid,void 0===this.$route.query.shippingid?this.isDivVisible=!1:(this.isDivVisible=!0,this.getShippingInfo(),this.getShippingProductList(),this.getShippingOptions(),this.getOptions())},mounted:function(){var t=this;this.timer=setTimeout((function(){t.getProductList(),console.log("ok")}),1e3)},methods:{handleCheckAll:function(t){var e=this;console.log(t.records);var i,n=Object(s["a"])(t.records);try{var a=function(){var t=i.value,n=e.tableData.findIndex((function(e){return e.detailid===t.detailid}));e.tableData[n].checked=t.checked};for(n.s();!(i=n.n()).done;)a()}catch(o){n.e(o)}finally{n.f()}console.log("Checkbox all",t)},handleCheckboxChange:function(t,e,i){var n=this.tableData.findIndex((function(e){return e.detailid===t.row.detailid}));this.tableData[n].checked=t.checked},getOptions:function(){var t=this,e={action:"product_list_view",subaction:"getOptions"};Object(u["a"])(e).then((function(e){console.log(e.data),t.selectoptions=e.data}))},handleChange:function(t){t.shipping_quantity-t.commodity_quantity>0?(d.a.modal.message({content:"发货数量不可大于库存数量",status:"error"}),t.shipping_quantity=""):t.shipping_weight=(t.shipping_quantity*t.unit_weight).toFixed(2)},onEnterUp:function(t,e){this.gotoNextRow(t)},onDownUp:function(t){t.shipping_quantity=t.commodity_quantity,t.shipping_weight=(t.shipping_quantity*t.unit_weight).toFixed(2),this.gotoNextRow(t)},getProjectInfo:function(t){var e=this,i=t.value;t.$event;if(null!==i){var n={action:"project_table_view",subaction:"getProjectInfo",shipping_address:i};Object(u["a"])(n).then((function(t){e.modalForm.project_contact_name=t.data.project_contact_name,e.modalForm.project_contact_phone=t.data.project_contact_phone}))}},getDriverInfo:function(t){var e=this,i=t.value,n=(t.$event,{action:"driver_table_view",subaction:"getDriverInfo",driver_name:i});Object(u["a"])(n).then((function(t){e.modalForm.licence_plate=t.data.licence_plate}))},getShippingOptions:function(){var t=this,e={action:"shipping_detail_table_view",subaction:"getShippingOptions"};Object(u["a"])(e).then((function(e){t.shipping_options=e.data}))},getShippingInfo:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i={action:"shipping_table_view",subaction:"getShippingInfoByShippingId",shippingid:t.current_shippingid},Object(u["a"])(i).then((function(e){var i=e.data[0];t.modalForm.shippingid=t.current_shippingid,t.modalForm.project_contact_name=i.project_contact_name,t.modalForm.shipping_address=i.shipping_address,t.modalForm.project_contact_phone=i.project_contact_phone,t.modalForm.driver_name=i.driver_name,t.modalForm.customer_name=i.customer_name,t.modalForm.delivery_date=i.delivery_date,t.modalForm.licence_plate=i.licence_plate,t.modalForm.username=i.username,t.modalForm.order_number_id=i.order_number_id}));case 2:case"end":return e.stop()}}),e)})))()},getShippingProductList:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i={action:"shipping_detail_table_view",subaction:"getProductListByShippingId",shippingid:t.current_shippingid},Object(u["a"])(i).then((function(e){t.shiptableData=e.data;var i,n=Object(s["a"])(t.shiptableData);try{for(n.s();!(i=n.n()).done;){var a=i.value;a.commodity_quantity=a.commodity_quantity+a.shipping_quantity}}catch(o){n.e(o)}finally{n.f()}}));case 2:case"end":return e.stop()}}),e)})))()},getProductList:function(){var t=this;return Object(r["a"])(Object(o["a"])().mark((function e(){var i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t.modalForm),console.log(t.modalForm.customer_name),i={action:"order_detail_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{customer_name:t.modalForm.customer_name,username:t.name}},Object(u["a"])(i).then((function(e){t.allData=e.data,t.allData=t.allData.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{checked:!1})}));var i,n=t.shiptableData,a=Object(s["a"])(n);try{var o=function(){var e=i.value,n=t.allData.findIndex((function(t){return t.detailid===e.detailid}));-1!==n&&(t.allData[n].checked=!0)};for(a.s();!(i=a.n()).done;)o()}catch(r){a.e(r)}finally{a.f()}t.tableData=t.allData,t.searchEvent()}));case 4:case"end":return e.stop()}}),e)})))()},searchEvent:function(){var t,e=this,i=Object(s["a"])(this.list);try{var n=function(){var i=t.value,n=e.tableData.findIndex((function(t){return t.detailid===i.detailid}));e.tableData[n].checked=i.checked};for(i.s();!(t=i.n()).done;)n()}catch(l){i.e(l)}finally{i.f()}var a=h.a.toValueString(this.searchOrderNumber).trim().toLowerCase();if(a){var o=new RegExp(a,"gi"),r=["order_number_id","control_no","commodity_details"],c=this.tableData.filter((function(t){return r.some((function(e){return h.a.toValueString(t[e]).toLowerCase().indexOf(a)>-1}))}));this.list=c.map((function(t){var e=Object.assign({},t);return r.forEach((function(t){e[t]=h.a.toValueString(e[t]).replace(o,(function(t){return t}))})),e}))}else this.list=this.tableData;console.log(this.list)},addProductEvent:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.modalDisplay=!0,e.getProductList();case 2:case"end":return t.stop()}}),t)})))()},isDetailIdExists:function(t){var e,i=Object(s["a"])(this.shiptableData);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.detailid===t)return!0}}catch(a){i.e(a)}finally{i.f()}return!1},addProductListEvent:function(){var t,e=this,i=this.tableData,n=Object(s["a"])(i);try{var a=function(){var i=t.value,n=e.shiptableData.findIndex((function(t){return t.detailid===i.detailid}));!0!==i.checked||e.shiptableData.find((function(t){return t.detailid===i.detailid}))?!1===i.checked&&e.shiptableData.find((function(t){return t.detailid===i.detailid}))&&e.shiptableData.splice(n,1):(i.shippingdetailid="",i.shipping_quantity="",e.shiptableData.push(i))};for(n.s();!(t=n.n()).done;)a()}catch(o){n.e(o)}finally{n.f()}this.modalDisplay=!1},deleteRowEvent:function(t){var e=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){try{e.allData.find((function(e){return e.detailid===t.detailid})).checked=!1,e.tableData.find((function(e){return e.detailid===t.detailid})).checked=!1}finally{var i=e.shiptableData.findIndex((function(e){return e.detailid===t.detailid}));-1!==i&&e.shiptableData.splice(i,1);var n={action:"shipping_detail_table_view",subaction:"deleteRecord",idmap:{shippingdetailid:t.shippingdetailid},detailid:t.detailid,quantity:t.shipping_quantity};Object(u["a"])(n).then((function(t){d.a.modal.message({content:"删除成功",status:"success"})}))}}))},saveEvent:function(){var t=this,e=this.shiptableData.findIndex((function(t){return""===t.shipping_quantity||isNaN(t.shipping_quantity)}));if(-1===e){var i=this.shiptableData,n={action:"shipping_detail_table_view",subaction:"saveShippingInfoByEdit",shippingid:this.current_shippingid,shippinginfo:{shipping_address:this.modalForm.shipping_address,driver_name_id:this.modalForm.driver_name,customer_name_id:this.modalForm.customer_name,delivery_date:this.modalForm.delivery_date,username_id:this.modalForm.username},shippingdetailid_list:i.map((function(t){return{detailid:t.detailid,shippingdetailid:t.shippingdetailid,shipping_quantity:t.shipping_quantity,shipping_weight:t.shipping_weight,order_number_id:t.order_number_id}}))};console.log(n),Object(u["a"])(n).then((function(e){t.$router.back(),d.a.modal.message({content:"保存成功",status:"success"})}))}else d.a.modal.message({content:"发货数量不可为空,或者必须为数字。",status:"warning"})},gotoNextRow:function(t){var e=this,i=this.shiptableData.indexOf(t),n=i+1;if(n<this.shiptableData.length)this.$nextTick((function(){var t=0;t=0===i?14:14+10*i;var n=e.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[t];n&&n.click()}));else{var a=this.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[5];console.warn(a),a&&(console.warn("找到数据"),a.click(),a.focus()),console.warn("No next row available")}}}},v=f,_=i("2877"),b=Object(_["a"])(v,n,a,!1,null,"9e117720",null);e["default"]=b.exports},"7db0":function(t,e,i){"use strict";var n=i("23e7"),a=i("b727").find,o=i("44d2"),r=i("ae40"),s="find",c=!0,l=r(s);s in[]&&Array(1)[s]((function(){c=!1})),n({target:"Array",proto:!0,forced:c||!l},{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),o(s)},d96b:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var n=i("b775");function a(t){return Object(n["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:t})}function o(t){return Object(n["a"])({url:"/vue-element-admin/backend/download_file/",method:"get",params:t})}}}]);