(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-737bf7f6"],{3285:function(e,t,a){"use strict";a("9179")},9179:function(e,t,a){},dd79:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDivVisible,expression:"isDivVisible"}]},[a("h3",[e._v(" 采购申请 ")]),a("vxe-grid",e._b({ref:"xGrid",attrs:{"checkbox-config":{trigger:"row",checkField:"isChecked",highlight:!0,range:!0}},on:{"checkbox-change":e.handleCheckboxChange,"checkbox-range-end":e.handleCheckboxRangeChange,"checkbox-all":e.handleCheckAll},scopedSlots:e._u([{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.searchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{field:"product_name",title:"产品名称","item-render":{name:"input",attrs:{placeholder:""}}}}),a("vxe-form-item",{attrs:{title:"采购状态"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.searchFormData.whether_buy,callback:function(t){e.$set(e.searchFormData,"whether_buy",t)},expression:"searchFormData.whether_buy"}},e._l(e.whether_buy_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.addRow()}}},[e._v("新增")]),a("vxe-button",{attrs:{status:"danger"},on:{click:function(t){return e.deleteAll()}}},[e._v("批量删除")])]},proxy:!0},{key:"operation",fn:function(t){var r=t.row;return[a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.editRow(r)}}},[e._v("编辑")]),a("vxe-button",{attrs:{status:"danger"},on:{click:function(t){return e.deleteRow(r)}}},[e._v("删除")])]}},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptions,!1)),a("vxe-modal",{attrs:{title:"编辑",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalAddDisplay,callback:function(t){e.modalAddDisplay=t},expression:"modalAddDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalAddSubmitEvent}},[a("vxe-form-item",{attrs:{title:"产品名称",span:24}},[a("vxe-input",{model:{value:e.modalAddForm.product_name,callback:function(t){e.$set(e.modalAddForm,"product_name",t)},expression:"modalAddForm.product_name"}})],1),a("vxe-form-item",{attrs:{title:"产品规格",span:24}},[a("vxe-input",{model:{value:e.modalAddForm.product_size,callback:function(t){e.$set(e.modalAddForm,"product_size",t)},expression:"modalAddForm.product_size"}})],1),a("vxe-form-item",{attrs:{title:"单位",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalAddForm.unit,callback:function(t){e.$set(e.modalAddForm,"unit",t)},expression:"modalAddForm.unit"}},e._l(e.unit_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"数量",span:24}},[a("vxe-input",{model:{value:e.modalAddForm.quantity,callback:function(t){e.$set(e.modalAddForm,"quantity",t)},expression:"modalAddForm.quantity"}})],1),a("vxe-form-item",{attrs:{title:"单价",span:24}},[a("vxe-input",{model:{value:e.modalAddForm.unit_price,callback:function(t){e.$set(e.modalAddForm,"unit_price",t)},expression:"modalAddForm.unit_price"}})],1),a("vxe-form-item",{attrs:{title:"总价",span:24}},[a("vxe-input",{model:{value:e.modalAddForm.total_price,callback:function(t){e.$set(e.modalAddForm,"total_price",t)},expression:"modalAddForm.total_price"}})],1),a("vxe-form-item",{attrs:{title:"备注",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalAddForm.remarks,callback:function(t){e.$set(e.modalAddForm,"remarks",t)},expression:"modalAddForm.remarks"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalAddDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("vxe-modal",{attrs:{title:"编辑",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalEditDisplay,callback:function(t){e.modalEditDisplay=t},expression:"modalEditDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalEditSubmitEvent}},[a("vxe-form-item",{attrs:{title:"产品名称",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.product_name,callback:function(t){e.$set(e.modalEditForm,"product_name",t)},expression:"modalEditForm.product_name"}})],1),a("vxe-form-item",{attrs:{title:"产品规格",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.product_size,callback:function(t){e.$set(e.modalEditForm,"product_size",t)},expression:"modalEditForm.product_size"}})],1),a("vxe-form-item",{attrs:{title:"单位",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalEditForm.unit,callback:function(t){e.$set(e.modalEditForm,"unit",t)},expression:"modalEditForm.unit"}},e._l(e.unit_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"数量",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.quantity,callback:function(t){e.$set(e.modalEditForm,"quantity",t)},expression:"modalEditForm.quantity"}})],1),a("vxe-form-item",{attrs:{title:"单价",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.unit_price,callback:function(t){e.$set(e.modalEditForm,"unit_price",t)},expression:"modalEditForm.unit_price"}})],1),a("vxe-form-item",{attrs:{title:"总价",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.total_price,callback:function(t){e.$set(e.modalEditForm,"total_price",t)},expression:"modalEditForm.total_price"}})],1),a("vxe-form-item",{attrs:{title:"备注",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalEditForm.remarks,callback:function(t){e.$set(e.modalEditForm,"remarks",t)},expression:"modalEditForm.remarks"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalEditDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("h3",[e._v(" 修改采购单(采购单号："+e._s(e.current_purchase_number)+") ")]),a("vxe-form",{attrs:{"title-align":"right","title-width":"100"}},[a("vxe-form-item",{attrs:{title:"采购员",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.username_options,clearable:"",filterable:""},model:{value:e.modalFormIn.username_id,callback:function(t){e.$set(e.modalFormIn,"username_id",t)},expression:"modalFormIn.username_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"供应商",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.supplier_name_options,clearable:"",filterable:""},model:{value:e.modalFormIn.supplier_name_id,callback:function(t){e.$set(e.modalFormIn,"supplier_name_id",t)},expression:"modalFormIn.supplier_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系人",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalFormIn.contact_person,callback:function(t){e.$set(e.modalFormIn,"contact_person",t)},expression:"modalFormIn.contact_person"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系方式",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalFormIn.contact_number,callback:function(t){e.$set(e.modalFormIn,"contact_number",t)},expression:"modalFormIn.contact_number"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"日期",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalFormIn.purchase_date,callback:function(t){e.$set(e.modalFormIn,"purchase_date",t)},expression:"modalFormIn.purchase_date"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"币种",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.currency_options,clearable:"",filterable:""},model:{value:e.modalFormIn.currency,callback:function(t){e.$set(e.modalFormIn,"currency",t)},expression:"modalFormIn.currency"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"备注",span:6}},[a("vxe-button",{staticStyle:{color:"#409EFF","font-weight":"bold",width:"100%"},attrs:{readonly:"",content:"从备注模版中导入"},on:{click:function(t){e.showTplDlg=!0}}})],1),a("vxe-form-item",{attrs:{title:"附件上传",span:6}},[a("vxe-button",{staticStyle:{color:"#409EFF","font-weight":"bold",width:"100%"},attrs:{readonly:"",content:"附件管理"},on:{click:function(t){e.modalUploadDisplay=!0}}})],1)],1),a("div",{staticClass:"purchase-container"},[a("div",{staticClass:"table-wrap",staticStyle:{"padding-top":"0","padding-right":"9px"}},[a("vxe-toolbar",{ref:"xToolbar",scopedSlots:e._u([{key:"buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary",content:"修改采购单"},on:{click:e.generatePurchase}})]},proxy:!0}])}),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",data:e.purchaseTableData,"keyboard-config":{isEdit:!0,isArrow:!0,isEnter:!0,isTab:!0,isDel:!0,isBack:!0},"mouse-config":{selected:!0},"edit-config":{trigger:"click",mode:"cell",showUpdateStatus:!0,showInsertStatus:!0}},on:{"edit-closed":e.handleEditClosed,select:e.handleCellClicked}},[a("vxe-column",{attrs:{type:"seq",width:"60",title:"序号",align:"center"}}),a("vxe-column",{attrs:{field:"product_name",title:"名称","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_name,callback:function(t){e.$set(r,"product_name",t)},expression:"row.product_name"}})]}}])}),a("vxe-column",{attrs:{field:"product_size",title:"规格","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_size,callback:function(t){e.$set(r,"product_size",t)},expression:"row.product_size"}})]}}])}),a("vxe-column",{attrs:{field:"unit_label",title:"单位","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.unit_label,callback:function(t){e.$set(r,"unit_label",t)},expression:"row.unit_label"}})]}}])}),a("vxe-column",{attrs:{field:"quantity",formatter:"trimZero2",title:"数量","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{focus:function(t){return e.ClearRow2(r)}},model:{value:r.quantity,callback:function(t){e.$set(r,"quantity",t)},expression:"row.quantity"}})]}}])}),a("vxe-column",{attrs:{field:"unit_price",title:"单价","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{focus:function(t){return e.ClearRow(r)}},model:{value:r.unit_price,callback:function(t){e.$set(r,"unit_price",t)},expression:"row.unit_price"}})]}}])}),a("vxe-column",{attrs:{field:"total_prices",title:"总价","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{change:function(t){return e.ConstTotal(r)}},model:{value:r.total_prices,callback:function(t){e.$set(r,"total_prices",t)},expression:"row.total_prices"}})]}}])}),a("vxe-column",{attrs:{field:"remark",title:"备注","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),a("vxe-column",{attrs:{title:"操作",width:"240",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("vxe-button",{attrs:{status:"danger",content:"删除"},on:{click:function(t){return e.removeRowEvent(r)}}})]}}])})],1)],1),a("div",[a("div",{staticClass:"remark-wrap"},[a("p",{staticStyle:{"padding-left":"20px"}},[e._v("备注:")]),a("quill-editor",{staticClass:"quill-box",staticStyle:{"padding-top":"0","padding-left":"20px"},attrs:{options:e.editorOptions},model:{value:e.modalFormIn.remark,callback:function(t){e.$set(e.modalFormIn,"remark",t)},expression:"modalFormIn.remark"}})],1)])]),a("remark-template-dialog",{attrs:{visible:e.showTplDlg},on:{"update:visible":function(t){e.showTplDlg=t},select:e.onTemplateSelect}}),a("upload-attachment-dialog",{attrs:{"init-files":e.oldFiles},on:{confirm:e.handleAttachConfirm},model:{value:e.modalUploadDisplay,callback:function(t){e.modalUploadDisplay=t},expression:"modalUploadDisplay"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isDivVisible,expression:"!isDivVisible"}]},[a("h4",[e._v("提示：请先到采购单管理页选择要编辑的采购单。")])])])},n=[],i=a("2909"),o=a("c7eb"),l=a("1da1"),s=a("b85c"),c=a("5530"),u=(a("99af"),a("4de4"),a("7db0"),a("c740"),a("d81d"),a("13d5"),a("4e82"),a("a434"),a("b0c0"),a("e9c4"),a("a9e3"),a("d3b7"),a("ac1f"),a("00b4"),a("498a"),a("0643"),a("2382"),a("fffc"),a("4e3e"),a("a573"),a("9d4a"),a("159b"),a("a388")),d=a("d96b"),m=(a("a753"),a("8096"),a("ba05")),p=a("953d"),f=a("2f62"),h=a("78e3"),b={components:{RemarkTemplateDialog:m["a"],UploadAttachmentDialog:h["a"]},computed:Object(c["a"])({quillEditor:p["quillEditor"]},Object(f["b"])(["sidebar","avatar","device","name"])),data:function(){var e=this;return{attachments:[],oldFiles:[],modalUploadDisplay:!1,showTplDlg:!1,dialogVisible:!1,editorContent:"",editorOptions:{placeholder:"请输入内容...",theme:"snow",modules:{toolbar:!1}},isDivVisible:!1,current_purchase_number:"",currency_options:[{label:"HKD",value:"HKD"},{label:"CNY",value:"CNY"},{label:"USD",value:"USD"}],modalFormIn:{purchase_date:""},purchaseTableData:[],unit_options:[{label:"件",value:"1"},{label:"套",value:"2"},{label:"批",value:"3"},{label:"千克",value:"4"},{label:"吨",value:"5"},{label:"包",value:"6"},{label:"盒",value:"7"},{label:"其他",value:"8"}],material_type_options:[{label:"原材料",value:"1"},{label:"焊材",value:"2"},{label:"耗材",value:"3"},{label:"工具",value:"4"},{label:"配件",value:"5"},{label:"螺丝",value:"6"},{label:"钻铣",value:"7"}],selectoptions:{},modalDisplay:!1,modalForm:{},modalAddDisplay:!1,modalEditDisplay:!1,modalAddForm:{},modalEditForm:{},whether_buy_options:[{label:"已采购",value:1},{label:"待采购",value:2}],searchFormData:{whether_buy:2},gridOptions:{resizable:!0,showOverflow:!0,height:500,border:"inner",rowId:"id",rowConfig:{isHover:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:100,pageSizes:[50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page,r=(t.sorts,t.filters,{action:"request_buy_table_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.searchFormData});return Object(d["b"])(r).then((function(t){var a=t.data||[],r=a.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{isChecked:!1})})),n=e.purchaseTableData;console.log(r),console.log(e.purchaseTableData);var i,o=Object(s["a"])(n);try{var l=function(){var e=i.value,t=r.findIndex((function(t){return t.requestid===e.requestid_id||t.requestid===e.requestid}));-1!==t&&(r[t].isChecked=!0)};for(o.s();!(i=o.n()).done;)l()}catch(u){o.e(u)}finally{o.f()}return{data:r,total:t.total}}))}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"seq",title:"序号",width:60},{type:"checkbox",title:"选择"},{field:"requestid",title:"ID",visible:!1},{field:"product_name",title:"产品名称",align:"center"},{field:"product_size",title:"产品规格"},{field:"quantity",title:"数量",formatter:"trimZero2"},{field:"unit",title:"单位",align:"center"},{field:"unit_price",title:"单价",align:"center"},{field:"total_price",title:"总价",align:"center"},{field:"username_id",title:"申请人",align:"center"},{field:"requestdate",title:"申请时间",align:"center"},{field:"whether_buy",title:"是否采购",visible:!1,align:"center"},{field:"whether_buy_label",title:"是否采购"},{field:"remarks",title:"备注"},{title:"操作",showOverflow:!0,width:"160px",fixed:"right",slots:{default:"operation"}}]}}},created:function(){},mounted:function(){this.getOptions(),this.current_purchase_number=this.$route.query.purchase_number,void 0===this.current_purchase_number?(this.current_purchase_number="",this.isDivVisible=!1):(this.isDivVisible=!0,this.getPurchaseTableData(),this.getPurchaseDetail(),this.getFileList())},methods:{getFileList:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["b"])({action:"attachment_file_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{model:"app.PurchaseTable",purchase_number:e.current_purchase_number}});case 2:a=t.sent,console.log(a.data),e.oldFiles=a.data||[];case 5:case"end":return t.stop()}}),t)})))()},handleAttachConfirm:function(e){this.attachments=e},onTemplateSelect:function(e){var t=this;this.modalFormIn.remark&&this.modalFormIn.remark!==e?this.$confirm("已存在备注，是否覆盖为所选模板？","提示").then((function(){t.modalFormIn.remark=e})).catch((function(){})):this.modalFormIn.remark=e},handleCellClicked:function(e){var t=e.row,a=e.column;this.$refs.xTable.triggerEdit(t,a)},handleCheckAll:function(){var e,t,a,r,n=this,i=this.$refs.xGrid.getTableData().fullData,o=[],l=[];i.forEach((function(e,i){var s=n.purchaseTableData.findIndex((function(t){return t.requestid===e.requestid}));if(l.push(s),!0===e.isChecked){-1!==s?(t=n.inTableData[s].quantity,a=n.inTableData[s].unit_price,r=n.inTableData[s].total_prices):(t=e.quantity,a=e.unit_price,r=e.total_prices);var c={requestid:e.requestid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit,quantity:t,unit_price:a,total_prices:r,remark:e.remarks};o.push(c)}})),(e=this.purchaseTableData).push.apply(e,o),l.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&n.purchaseTableData.splice(e,1)}))},handleCheckboxRangeChange:function(e){var t,a,r,n,i=this,o=(e.$event,this.$refs.xGrid.getTableData().fullData),l=[],s=[];o.forEach((function(e,t){var o=i.purchaseTableData.findIndex((function(t){return t.requestid===e.requestid}));if(s.push(o),!0===e.isChecked){-1!==o?(a=i.inTableData[o].quantity,r=i.inTableData[o].unit_price,n=i.inTableData[o].total_prices):(a=e.quantity,r=e.unit_price,n=e.total_prices);var c={requestid:e.requestid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit,quantity:a,unit_price:r,total_prices:n,remark:e.remarks};l.push(c)}})),(t=this.purchaseTableData).push.apply(t,l),s.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&i.purchaseTableData.splice(e,1)}))},deleteAll:function(){var e=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){var t=e.$refs.xGrid.getCheckboxRecords();console.log(t);var a=[];t.forEach((function(t){var r=e.purchaseTableData.findIndex((function(e){return e.inventoryid===t.inventoryid}));e.purchaseTableData.splice(r,1),a.push(t.requestid)}));var r={action:"request_buy_table_view",subaction:"batchDelete",requestid_list:a};Object(d["b"])(r).then((function(t){u["VXETable"].modal.message({content:"删除成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))}))},ClearRow:function(e){console.log(e),"0.00"!==e.unit_price&&0!==e.unit_price||(e.unit_price="")},ClearRow2:function(e){0===e.quantity&&(e.quantity="")},onEnterUp:function(e,t,a){var r=this,n=this.purchaseTableData.indexOf(e),i=n+1;if(i<this.purchaseTableData.length)this.$nextTick((function(){var e=0;e=0===n?6+t:6+t+7*n;var a=r.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[e];a&&a.click()}));else{var o=this.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[t];console.warn(o),o&&(console.warn("找到数据"),o.click(),o.focus()),console.warn("No next row available")}},getPurchaseDetail:function(){var e=this,t={action:"purchase_detail_table_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{purchase_number:this.current_purchase_number}};Object(d["b"])(t).then((function(t){e.purchaseTableData=t.data,console.log(e.purchaseTableData),e.purchaseTableData.forEach((function(e){e.unit_label=e.unit,e.total_prices=e.total_price}))}))},getPurchaseTableData:function(){var e=this,t={action:"purchase_table_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{purchase_number:this.current_purchase_number}};Object(d["b"])(t).then((function(t){console.log(t.data),e.modalFormIn=t.data[0]}))},handleEditClosed:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column,e.columnIndex);e.$columnIndex;4!==a&&5!==a||(t.total_prices=t.quantity*t.unit_price)},generatePurchase:function(){if(""!==this.modalFormIn.username_id&&""!==this.modalFormIn.supplier_name_id&&""!==this.modalFormIn.contact_person&&""!==this.modalFormIn.contact_number&&""!==this.modalFormIn.purchase_date&&""!==this.modalFormIn.currency&&0!==this.purchaseTableData.length){console.log(this.purchaseTableData);var e=this.purchaseTableData.findIndex((function(e){return""===e.quantity||isNaN(e.quantity)||e.quantity<0||null===e.unit_price||""===e.unit_price||isNaN(e.unit_price)||e.unit_price<0||null===e.total_prices||""===e.total_prices||isNaN(e.total_prices)||e.total_prices<0}));if(-1===e){u["VXETable"].modal.message({content:"生成中, 请稍候...",status:"success"});var t=this.$refs.xTable,a=t.getRecordset(),r=a.insertRecords,n=[].concat(Object(i["a"])(r),Object(i["a"])(this.purchaseTableData)),o=this.attachments.reduce((function(e,t){return void 0!==t.attachmentid&&(e.keepIds.push(t.attachmentid),e.edited.push({id:t.attachmentid,filename:t.filename})),e}),{keepIds:[],edited:[]}),l=o.keepIds,s=o.edited,m=this.attachments.filter((function(e){return"undefined"===typeof e.attachmentid&&e.raw})).map((function(e){return e.raw})),p=Object(c["a"])(Object(c["a"])({},this.modalFormIn),{},{purchase_number:this.current_purchase_number,keep_attachment_ids:l,edited_attachments:s}),f=new FormData;f.append("action","complex_view"),f.append("subaction","generate_purchase_order_modify"),f.append("formdata",JSON.stringify(p)),f.append("tabledata",JSON.stringify(n)),m.forEach((function(e){return f.append("attachments",e)})),Object(d["b"])(f,{headers:{"Content-Type":"multipart/form-data"},responseType:"json",timeout:0}).then((function(e){0===e.code?u["VXETable"].modal.message({content:"修改成功",status:"success"}):u["VXETable"].modal.message({content:"修改失败:{response.msg}",status:"error"})})),this.$router.push({path:"/erppurchase/purchase_table_view"})}else u["VXETable"].modal.message({content:"发货数量或者单价不可为空,或者必须为数字。",status:"warning"})}else u["VXETable"].modal.message({content:"请填写完整信息",status:"error"})},insertEvent:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var a,r,n,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.xTable,r={},t.next=4,a.insert(r);case 4:return n=t.sent,i=n.row,t.next=8,a.setEditRow(i);case 8:case"end":return t.stop()}}),t)})))()},removeRowEvent:function(e){var t=this;return Object(l["a"])(Object(o["a"])().mark((function a(){var r,n,i,l;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:console.log(e),r=e.requestid_id,console.log(r),n=t.purchaseTableData.findIndex((function(e){return e.requestid_id===r})),t.purchaseTableData.splice(n,1),i=t.$refs.xGrid.getTableData().fullData.find((function(e){return e.requestid===r})),i&&(l=t.$refs.xGrid.getTableData().fullData.findIndex((function(e){return e.requestid===r})),t.$refs.xGrid.getTableData().fullData[l].isChecked=!1);case 7:case"end":return a.stop()}}),a)})))()},handleCheckboxChange:function(e){var t=e.row,a=(e.rowIndex,e.checked);if(!0===a){var r={requestid:t.requestid,isChecked:t.isChecked,product_name:t.product_name,product_size:t.product_size,unit_label:t.unit,quantity:t.quantity,unit_price:t.unit_price,total_prices:t.total_price,remark:t.remarks};this.purchaseTableData.push(r)}else{var n=this.purchaseTableData.findIndex((function(e){return e.requestid===t.requestid}));console.log(n),this.purchaseTableData.splice(n,1)}},getOptions:function(){var e=this,t={action:"warehous_entry_table_view",subaction:"getOptions"};Object(d["b"])(t).then((function(t){e.selectoptions=t.data}))},addRow:function(){this.modalAddForm={username_id:this.name,whether_buy:2},this.modalAddDisplay=!0},modalSubmitEvent:function(){var e=this,t={action:"inventory_table_view",subaction:"addRecord",modalForm:this.modalForm};Object(d["b"])(t).then((function(t){e.modalDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},deleteRow:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){var a=t.$refs.xGrid.$data["tableData"];for(var r in a)e.id===a[r].id&&a.splice(r,1);var n={action:"request_buy_table_view",subaction:"deleteRecord",idmap:{purchaseid:e.purchaseid}};Object(d["b"])(n).then((function(e){u["VXETable"].modal.message({content:"删除成功",status:"success"}),t.$refs.xGrid.commitProxy("reload")}))}))},editRow:function(e){this.modalEditDisplay=!0,this.modalEditForm=e;var t=a("2ef0");this.modalEditForm=t.cloneDeep(e),delete this.modalEditForm.id,delete this.modalEditForm.unit_label,delete this.modalEditForm.material_type_label,delete this.modalEditForm.whether_buy_label},modalAddSubmitEvent:function(){var e=this;if(this.checkAddForm(this.modalAddForm)){var t={action:"request_buy_table_view",subaction:"addRecord",modalForm:this.modalAddForm};Object(d["b"])(t).then((function(t){e.modalAddDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))}},modalEditSubmitEvent:function(){var e=this;if(this.checkAddForm(this.modalEditForm)){var t={action:"request_buy_table_view",subaction:"editRecord",modalEditForm:this.modalEditForm,idmap:{requestid:this.modalEditForm.requestid}};Object(d["b"])(t).then((function(t){e.modalEditDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))}},checkAddForm:function(e){if(!e.product_name||!e.product_name.trim())return u["VXETable"].modal.message({content:"请输入「产品名称」",status:"error"}),!1;if(!e.product_size||!e.product_size.trim())return u["VXETable"].modal.message({content:"请输入「产品规格」",status:"error"}),!1;if(!e.unit)return u["VXETable"].modal.message({content:"请选择「单位」",status:"error"}),!1;var t=Number(e.quantity);return!(!/^[1-9]\d*(\.\d{1,2})?$/.test(e.quantity)||t<=0)||(u["VXETable"].modal.message({content:"「数量」必须为正数，最多两位小数",status:"error"}),!1)},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},resetEvent:function(){this.searchFormData={},this.$refs.xGrid.commitProxy("reload")}}},v=b,_=(a("3285"),a("2877")),x=Object(_["a"])(v,r,n,!1,null,"2de7a767",null);t["default"]=x.exports}}]);