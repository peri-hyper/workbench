(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ffa79de"],{"4e82":function(e,t,a){"use strict";var r=a("23e7"),n=a("1c0b"),i=a("7b0b"),o=a("d039"),c=a("a640"),l=[],s=l.sort,u=o((function(){l.sort(void 0)})),d=o((function(){l.sort(null)})),f=c("sort"),p=u||!d||!f;r({target:"Array",proto:!0,forced:p},{sort:function(e){return void 0===e?s.call(i(this)):s.call(i(this),n(e))}})},"56f4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("h3",[e._v(" 选择产品 ")]),a("el-tabs",{staticStyle:{"margin-top":"20px"},attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"库存列表"}},[a("vxe-grid",e._b({ref:"xGrid",attrs:{size:"small","checkbox-config":{trigger:"row",checkField:"isChecked",highlight:!0,range:!0}},on:{"checkbox-change":e.handleCheckboxChange,"checkbox-range-end":e.handleCheckboxRangeChange,"checkbox-all":e.handleCheckAll},scopedSlots:e._u([{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.searchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{field:"product_name__icontains",title:"全局搜索","item-render":{name:"input",attrs:{placeholder:""}}}}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptions,!1))],1),a("el-tab-pane",{attrs:{label:"产品列表"}},[a("vxe-grid",e._b({ref:"xGridProduct",attrs:{size:"small","checkbox-config":{trigger:"row",checkField:"isChecked",highlight:!0,range:!0}},on:{"checkbox-change":e.handleCheckboxChangeProduct,"checkbox-range-end":e.handleCheckboxRangeChangePrdouct,"checkbox-all":e.handleCheckAll2},scopedSlots:e._u([{key:"search_buttons_product",fn:function(){return[a("vxe-form",{attrs:{data:e.searchFormDataProduct.search_data},on:{submit:e.searchEventProduct,reset:e.resetEventProduct}},[a("vxe-form-item",{attrs:{field:"search_data",title:"全局搜索","item-render":{name:"input",attrs:{placeholder:""}}}}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptionsProduct,!1))],1)],1),a("h3",[e._v(" 申请采购 ")]),a("vxe-toolbar",{ref:"xToolbar",scopedSlots:e._u([{key:"buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary",content:"新增"},on:{click:e.insertEvent}}),a("vxe-button",{attrs:{status:"primary",content:"申请采购"},on:{click:e.generatePurchase}})]},proxy:!0}])}),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","show-overflow":"","keep-source":"","keyboard-config":{isEdit:!0,isArrow:!0,isEnter:!0,isTab:!0,isDel:!0,isBack:!0},"mouse-config":{selected:!0},data:e.purchaseTableData,"edit-config":{trigger:"click",mode:"cell",showUpdateStatus:!0,showInsertStatus:!0}},on:{"edit-closed":e.handleEditClosed,select:e.handleCellClicked}},[a("vxe-column",{attrs:{type:"seq",width:"60",title:"序号",align:"center"}}),a("vxe-column",{attrs:{field:"product_name",title:"名称","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_name,callback:function(t){e.$set(r,"product_name",t)},expression:"row.product_name"}})]}}])}),a("vxe-column",{attrs:{field:"product_size",title:"规格","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_size,callback:function(t){e.$set(r,"product_size",t)},expression:"row.product_size"}})]}}])}),a("vxe-column",{attrs:{field:"unit_label",title:"单位","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.unit_label,callback:function(t){e.$set(r,"unit_label",t)},expression:"row.unit_label"}})]}}])}),a("vxe-column",{attrs:{field:"quantity",title:"数量","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"},align:"center"},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{focus:function(t){return e.ClearRow2(r)}},model:{value:r.quantity,callback:function(t){e.$set(r,"quantity",t)},expression:"row.quantity"}})]}}])}),a("vxe-column",{attrs:{field:"remark",title:"备注","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),a("vxe-column",{attrs:{title:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("vxe-button",{attrs:{status:"danger",content:"删除"},on:{click:function(t){return e.removeRowEvent(r)}}})]}}])})],1)],1)},n=[],i=a("c7eb"),o=a("2909"),c=a("1da1"),l=a("b85c"),s=a("5530"),u=(a("99af"),a("7db0"),a("c740"),a("d81d"),a("4e82"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("498a"),a("0643"),a("fffc"),a("4e3e"),a("a573"),a("159b"),a("a388")),d=a("d96b"),f=a("2f62"),p={computed:Object(s["a"])({},Object(f["b"])(["name"])),data:function(){var e=this;return{modalFormIn:{purchase_date:""},purchaseTableData:[],unit_options:[{label:"件",value:"1"},{label:"套",value:"2"},{label:"批",value:"3"},{label:"千克",value:"4"},{label:"吨",value:"5"},{label:"包",value:"6"},{label:"盒",value:"7"},{label:"其他",value:"8"}],material_type_options:[{label:"原材料",value:"1"},{label:"焊材",value:"2"},{label:"耗材",value:"3"},{label:"工具",value:"4"},{label:"配件",value:"5"},{label:"螺丝",value:"6"},{label:"钻铣",value:"7"}],selectoptions:{},modalDisplay:!1,modalForm:{},modalEditDisplay:!1,modalEditForm:{},row_id:1,searchFormData:{},searchFormDataProduct:{search_data:""},gridOptionsProduct:{data:[],resizable:!0,showOverflow:!0,height:500,border:"inner",rowConfig:{keyField:"inventoryid",isHover:!0},checkboxConfig:{reserve:!0,labelField:["order_number"],highlight:!0,range:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:100,pageSizes:[50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page;t.sorts,t.filters;e.searchFormDataProduct.username=e.name;var r={action:"product_list_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.searchFormDataProduct};return Object(d["b"])(r).then((function(t){var a=t.data||[],r=a.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{isChecked:!1})})),n=e.purchaseTableData;console.log(e.purchaseTableData);var i,o=Object(l["a"])(n);try{var c=function(){var e=i.value,t=r.findIndex((function(t){return t.detailid===e.detailid}));!0===e.isChecked&&-1!==t&&(r[t].isChecked=!0)};for(o.s();!(i=o.n()).done;)c()}catch(u){o.e(u)}finally{o.f()}return{data:r,total:t.total}}))}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons_product"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"seq",title:"序号",width:60,align:"center"},{type:"checkbox",title:"选择"},{field:"detailid",title:"ID",visible:!1},{field:"order_number_id",title:"订单号码",align:"center"},{field:"project_name",title:"项目名称"},{field:"customer_name",title:"客户名称",visible:!1},{field:"commodity_details",title:"品名",align:"center"},{field:"commodity_size",title:"规格"},{field:"control_no",title:"编号",align:"center"},{field:"commodity_units",title:"单位",align:"center"},{field:"commodity_quantity",title:"产品数量",align:"center"},{field:"unit_weight",title:"单件重量",align:"center"},{field:"commodity_weight",title:"重量",align:"center"},{field:"remarks",title:"备注",align:"center"}]},gridOptions:{tableData:[],resizable:!0,showOverflow:!0,height:500,border:"inner",rowConfig:{keyField:"inventoryid",isHover:!0},checkboxConfig:{reserve:!0,labelField:["order_number"],highlight:!0,range:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:100,pageSizes:[50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page,r=(t.sorts,t.filters,{action:"inventory_table_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.searchFormData});return Object(d["b"])(r).then((function(t){var a=t.data||[],r=a.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{isChecked:!1})})),n=e.purchaseTableData;console.log(e.purchaseTableData);var i,o=Object(l["a"])(n);try{var c=function(){var e=i.value,t=r.findIndex((function(t){return t.inventoryid===e.inventoryid}));!0===e.isChecked&&-1!==t&&(r[t].isChecked=!0)};for(o.s();!(i=o.n()).done;)c()}catch(u){o.e(u)}finally{o.f()}return{data:r,total:t.total}}))}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"seq",title:"序号",width:60,align:"center"},{type:"checkbox",title:"选择"},{field:"inventoryid",title:"库存ID",visible:!1},{field:"product_name",title:"产品名称",align:"center"},{field:"product_size",title:"产品规格"},{field:"unit",title:"单位",align:"center"},{field:"unit_label",title:"单位",align:"center"},{field:"quantity",title:"数量",align:"center"},{field:"brand",title:"品牌",align:"center"},{field:"material_certificate",title:"材质",align:"center"},{field:"material_type",title:"类型",align:"center"},{field:"remark",title:"备注",align:"center"}]}}},created:function(){},mounted:function(){this.getOptions()},methods:{handleCellClicked:function(e){var t=e.row,a=e.column;this.$refs.xTable.triggerEdit(t,a)},handleCheckAll:function(e){var t,a=this,r=(e.checked,this.$refs.xGrid.getTableData().fullData),n=[],i=[];r.forEach((function(e,t){var r=a.purchaseTableData.findIndex((function(t){return t.inventoryid===e.inventoryid}));if(i.push(r),!0===e.isChecked){var o={inventoryid:e.inventoryid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit_label,quantity:0,unit_price:0,total_prices:0};n.push(o)}})),(t=this.purchaseTableData).push.apply(t,n),i.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&a.purchaseTableData.splice(e,1)}))},handleCheckAll2:function(){var e,t=this,a=this.$refs.xGridProduct.getTableData().fullData,r=[],n=[];a.forEach((function(e,a){var i=t.purchaseTableData.findIndex((function(t){return t.detailid===e.detailid}));n.push(i);var o=e.remarks;if("鈴木鐵閘(香港)有限公司"===e.customer_name&&(o=e.project_name),!0===e.isChecked){var c={detailid:e.detailid,isChecked:e.isChecked,product_name:e.commodity_details,product_size:e.control_no+" : "+e.commodity_size,unit_label:e.commodity_units,quantity:0,unit_price:0,total_prices:0,remark:o};r.push(c)}})),(e=this.purchaseTableData).push.apply(e,r),n.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&t.purchaseTableData.splice(e,1)}))},ConstTotal:function(e){e.total_prices=e.unit_price*e.quantity},ClearRow:function(e){0===e.unit_price&&(e.unit_price="")},ClearRow2:function(e){0===e.quantity&&(e.quantity="")},onEnterUp:function(e,t,a){var r=this,n=this.purchaseTableData.indexOf(e),i=n+1;if(i<this.purchaseTableData.length)this.$nextTick((function(){var e=0;e=0===n?6+t:6+t+7*n;var a=r.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[e];a&&a.click()}));else{var o=this.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[t];console.warn(o),o&&(console.warn("找到数据"),o.click(),o.focus()),console.warn("No next row available")}},handleEditClosed:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column,e.columnIndex);e.$columnIndex;4!==a&&5!==a||(t.total_prices=t.quantity*t.unit_price)},validateTableData:function(e){for(var t=0;t<e.length;t++){var a=e[t],r=t+1;if(!a.product_name||""===a.product_name.toString().trim())return"第 ".concat(r," 行：产品名称不能为空");if(!a.product_size||""===a.product_size.toString().trim())return"第 ".concat(r," 行：产品规格不能为空");if(!a.unit_label||""===a.unit_label.toString().trim())return"第 ".concat(r," 行：单位不能为空");var n=Number(a.quantity);if(isNaN(n)||n<=0)return"第 ".concat(r," 行：数量必须为大于 0 的数字")}return null},generatePurchase:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n,c,l,s,f;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$refs.xTable,r=a.getRecordset(),n=r.insertRecords,c=[].concat(Object(o["a"])(n),Object(o["a"])(e.purchaseTableData)),l=e.validateTableData(c),!l){t.next=7;break}return u["VXETable"].modal.message({content:l,status:"warning"}),t.abrupt("return");case 7:return s=c.map((function(t){return{product_name:t.product_name,product_size:t.product_size,unit:t.unit_label,quantity:t.quantity,unit_price:t.unit_price,total_price:t.total_prices,whether_buy:2,username_id:e.name,remarks:t.remark}})),f={action:"request_buy_table_view",subaction:"addRecordList",modalFormList:s},t.prev=9,t.next=12,Object(d["b"])(f);case 12:u["VXETable"].modal.message({content:"提交成功",status:"success"}),a.data=[],t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](9),u["VXETable"].modal.message({content:"提交失败：".concat(t.t0.message),status:"error"});case 19:case"end":return t.stop()}}),t,null,[[9,16]])})))()},insertEvent:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n,o;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.xTable,r={quantity:0,unit_price:0,total_prices:0,row_id:e.row_id},e.row_id++,e.purchaseTableData.push(r),t.next=6,a.insert(r);case 6:return n=t.sent,o=n.row,t.next=10,a.setEditRow(o);case 10:case"end":return t.stop()}}),t)})))()},removeRowEvent:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){var r,n,o,c,l,s,u,d,f,p;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=e.inventoryid,n=e.detailid,o=e.row_id,console.log(t.purchaseTableData),console.log(e),r?(c=t.purchaseTableData.findIndex((function(e){return e.inventoryid===r})),t.purchaseTableData.splice(c,1),l=t.$refs.xGrid.getTableData().fullData.find((function(e){return e.inventoryid===r})),l&&(s=t.$refs.xGrid.getTableData().fullData.findIndex((function(e){return e.inventoryid===r})),t.$refs.xGrid.getTableData().fullData[s].isChecked=!1)):n?(u=t.purchaseTableData.findIndex((function(e){return e.detailid===n})),t.purchaseTableData.splice(u,1),d=t.$refs.xGridProduct.getTableData().fullData.find((function(e){return e.detailid===n})),d&&(f=t.$refs.xGridProduct.getTableData().fullData.findIndex((function(e){return e.detailid===n})),t.$refs.xGridProduct.getTableData().fullData[f].isChecked=!1)):o&&(p=t.purchaseTableData.findIndex((function(e){return e.row_id===o})),t.purchaseTableData.splice(p,1));case 6:case"end":return a.stop()}}),a)})))()},handleCheckboxChange:function(e){var t=e.row,a=e.checked;e.rowIndex;if(!0===a){var r=Object(s["a"])(Object(s["a"])({},t),{},{quantity:0,unit_price:0,total_prices:0});this.purchaseTableData.push(r)}else{var n=this.purchaseTableData.findIndex((function(e){return e.inventoryid===t.inventoryid}));this.purchaseTableData.splice(n,1)}},handleCheckboxRangeChange:function(e){var t,a=this,r=(e.$event,this.$refs.xGrid.getTableData().fullData),n=[],i=[];r.forEach((function(e,t){var r=a.purchaseTableData.findIndex((function(t){return t.inventoryid===e.inventoryid}));if(i.push(r),!0===e.isChecked){var o={inventoryid:e.inventoryid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit_label,quantity:0,unit_price:0,total_prices:0};n.push(o)}})),(t=this.purchaseTableData).push.apply(t,n),i.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&a.purchaseTableData.splice(e,1)}))},handleCheckboxRangeChangePrdouct:function(e){var t,a=this,r=(e.$event,this.$refs.xGridProduct.getTableData().fullData),n=[],i=[];r.forEach((function(e,t){var r=a.purchaseTableData.findIndex((function(t){return t.detailid===e.detailid}));i.push(r);var o=e.remarks;if("鈴木鐵閘(香港)有限公司"===e.customer_name&&(o=e.project_name),!0===e.isChecked){var c={detailid:e.detailid,isChecked:e.isChecked,product_name:e.commodity_details,product_size:e.control_no+" : "+e.commodity_size,unit_label:e.commodity_units,quantity:0,unit_price:0,total_prices:0,remark:o};n.push(c)}})),(t=this.purchaseTableData).push.apply(t,n),i.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&a.purchaseTableData.splice(e,1)}))},handleCheckboxChangeProduct:function(e){var t=e.row,a=(e.rowIndex,e.checked),r=t.remarks;if("鈴木鐵閘(香港)有限公司"===t.customer_name&&(r=t.project_name),!0===a){var n={detailid:t.detailid,isChecked:t.isChecked,product_name:t.commodity_details,product_size:t.control_no+" : "+t.commodity_size,unit_label:t.commodity_units,quantity:0,unit_price:0,total_prices:0,remark:r};this.purchaseTableData.push(n),console.log(this.purchaseTableData)}else{var i=this.purchaseTableData.findIndex((function(e){return e.detailid===t.detailid}));console.log(i),this.purchaseTableData.splice(i,1)}},getOptions:function(){var e=this,t={action:"warehous_entry_table_view",subaction:"getOptions"};Object(d["b"])(t).then((function(t){e.selectoptions=t.data}))},addRow:function(){this.modalForm={},this.modalDisplay=!0},modalSubmitEvent:function(){var e=this,t={action:"inventory_table_view",subaction:"addRecord",modalForm:this.modalForm};Object(d["b"])(t).then((function(t){e.modalDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},modalEditSubmitEvent:function(){var e=this,t={action:"inventory_table_view",subaction:"editRecord",modalEditForm:this.modalEditForm,idmap:{inventoryid:this.modalEditForm.inventoryid}};Object(d["b"])(t).then((function(t){e.modalEditDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},searchEventProduct:function(){this.$refs.xGridProduct.commitProxy("reload")},resetEvent:function(){this.searchFormData={product_name__icontains:""},this.$refs.xGrid.commitProxy("reload")},resetEventProduct:function(){this.searchFormDataProduct={search_data:""},this.$refs.xGridProduct.commitProxy("reload")}}},h=p,b=a("2877"),m=Object(b["a"])(h,r,n,!1,null,null,null);t["default"]=m.exports},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,i=a("44d2"),o=a("ae40"),c="find",l=!0,s=o(c);c in[]&&Array(1)[c]((function(){l=!1})),r({target:"Array",proto:!0,forced:l||!s},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i(c)},d96b:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return c}));var r=a("5530"),n=a("b775");function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/process/"),method:"post",data:e,timeout:5e3},t))}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/download_file/"),method:"get",params:e,responseType:"blob",timeout:0},t))}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e,responseType:"blob",noCodeCheck:!0,timeout:0},t))}},fffc:function(e,t,a){"use strict";var r=a("23e7"),n=a("2266"),i=a("1c0b"),o=a("825a");r({target:"Iterator",proto:!0,real:!0},{find:function(e){return o(this),i(e),n(this,(function(t){if(e(t))return n.stop(t)}),void 0,!1,!0).result}})}}]);