(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2549b90c"],{d96b:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return l}));var o=a("5530"),n=a("b775");function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(o["a"])({url:"".concat("","/vue-element-admin/backend/process/"),method:"post",data:e,timeout:5e3},t))}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(o["a"])({url:"".concat("","/vue-element-admin/backend/download_file/"),method:"get",params:e,responseType:"blob",timeout:0},t))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(o["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e,responseType:"blob",noCodeCheck:!0,timeout:0},t))}},e9c4:function(e,t,a){var o=a("23e7"),n=a("d066"),r=a("d039"),i=n("JSON","stringify"),l=/[\uD800-\uDFFF]/g,s=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(e,t,a){var o=a.charAt(t-1),n=a.charAt(t+1);return s.test(e)&&!c.test(n)||c.test(e)&&!s.test(o)?"\\u"+e.charCodeAt(0).toString(16):e},d=r((function(){return'"\\udf06\\ud834"'!==i("\udf06\ud834")||'"\\udead"'!==i("\udead")}));i&&o({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,a){var o=i.apply(null,arguments);return"string"==typeof o?o.replace(l,u):o}})},efb3:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("vxe-grid",e._b({ref:"xGrid",attrs:{"highlight-current-row":"","checkbox-config":{highlight:!0,range:!0}},on:{"cell-dblclick":e.localOpenHandle,"current-change":e.handleCurrentChange},scopedSlots:e._u([{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.searchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{field:"search_data",title:"全局搜索","item-render":{name:"input",attrs:{placeholder:""}}}}),a("vxe-form-item",{attrs:{title:"日期查询"},scopedSlots:e._u([{key:"default",fn:function(){return[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:e.shortcuts,size:e.size},model:{value:e.searchFormData.purchase_date__range,callback:function(t){e.$set(e.searchFormData,"purchase_date__range",t)},expression:"searchFormData.purchase_date__range"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary"},on:{click:e.localOpenHandle}},[e._v("本地打开")]),e._v(" "),a("vxe-button",{attrs:{status:"warning"},on:{click:e.batchDownload}},[e._v("批量下载")]),a("vxe-button",{attrs:{status:"primary"},on:{click:e.dowloadFileHandle}},[e._v("下载")])]},proxy:!0},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptions,!1)),a("vxe-modal",{attrs:{title:"新增",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalDisplay,callback:function(t){e.modalDisplay=t},expression:"modalDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalSubmitEvent}},[a("vxe-form-item",{attrs:{title:"客户名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.customer_name_options,clearable:"",filterable:""},model:{value:e.modalForm.customer_name,callback:function(t){e.$set(e.modalForm,"customer_name",t)},expression:"modalForm.customer_name"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"订单号码",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.order_number_options,clearable:"",filterable:""},model:{value:e.modalForm.order_number,callback:function(t){e.$set(e.modalForm,"order_number",t)},expression:"modalForm.order_number"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"文件名",span:24}},[a("vxe-input",{model:{value:e.modalForm.filename,callback:function(t){e.$set(e.modalForm,"filename",t)},expression:"modalForm.filename"}})],1),a("vxe-form-item",{attrs:{title:"新文件名",span:24}},[a("vxe-input",{model:{value:e.modalForm.new_filename,callback:function(t){e.$set(e.modalForm,"new_filename",t)},expression:"modalForm.new_filename"}})],1),a("vxe-form-item",{attrs:{title:"上传时间",span:24}},[a("vxe-input",{model:{value:e.modalForm.upload_time,callback:function(t){e.$set(e.modalForm,"upload_time",t)},expression:"modalForm.upload_time"}})],1),a("vxe-form-item",{attrs:{title:"文件大小",span:24}},[a("vxe-input",{model:{value:e.modalForm.file_size,callback:function(t){e.$set(e.modalForm,"file_size",t)},expression:"modalForm.file_size"}})],1),a("vxe-form-item",{attrs:{title:"文件后缀",span:24}},[a("vxe-input",{model:{value:e.modalForm.file_suffix,callback:function(t){e.$set(e.modalForm,"file_suffix",t)},expression:"modalForm.file_suffix"}})],1),a("vxe-form-item",{attrs:{title:"文件类型",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalForm.file_type,callback:function(t){e.$set(e.modalForm,"file_type",t)},expression:"modalForm.file_type"}},e._l(e.file_type_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("vxe-modal",{attrs:{title:"编辑",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalEditDisplay,callback:function(t){e.modalEditDisplay=t},expression:"modalEditDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalEditSubmitEvent}},[a("vxe-form-item",{attrs:{title:"订单号码",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.order_number_options,clearable:"",filterable:""},model:{value:e.modalEditForm.order_number_id,callback:function(t){e.$set(e.modalEditForm,"order_number_id",t)},expression:"modalEditForm.order_number_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"文件名",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.filename,callback:function(t){e.$set(e.modalEditForm,"filename",t)},expression:"modalEditForm.filename"}})],1),a("vxe-form-item",{attrs:{title:"新文件名",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.new_filename,callback:function(t){e.$set(e.modalEditForm,"new_filename",t)},expression:"modalEditForm.new_filename"}})],1),a("vxe-form-item",{attrs:{title:"上传时间",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.upload_time,callback:function(t){e.$set(e.modalEditForm,"upload_time",t)},expression:"modalEditForm.upload_time"}})],1),a("vxe-form-item",{attrs:{title:"文件大小",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.file_size,callback:function(t){e.$set(e.modalEditForm,"file_size",t)},expression:"modalEditForm.file_size"}})],1),a("vxe-form-item",{attrs:{title:"文件后缀",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.file_suffix,callback:function(t){e.$set(e.modalEditForm,"file_suffix",t)},expression:"modalEditForm.file_suffix"}})],1),a("vxe-form-item",{attrs:{title:"文件类型",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalEditForm.file_type,callback:function(t){e.$set(e.modalEditForm,"file_type",t)},expression:"modalEditForm.file_type"}},e._l(e.file_type_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalEditDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1)],1)},n=[],r=a("c7eb"),i=a("3835"),l=a("1da1"),s=(a("99af"),a("d81d"),a("e9c4"),a("b680"),a("d3b7"),a("4d63"),a("ac1f"),a("2c3e"),a("25f0"),a("3ca3"),a("5319"),a("0643"),a("a573"),a("ddb0"),a("5c96")),c=a("a388"),u=a("d96b"),d="O:\\producterp\\producterp\\attachments\\purchasetable\\",m="http://127.0.0.1:3210",p={data:function(){var e=this;return{lastOpenedPath:"",file_type_options:[{label:"合同/订单",value:1},{label:"图纸",value:2},{label:"已签收发货单",value:3},{label:"验焊报告",value:4},{label:"质检报告",value:5},{label:"镀锌报告",value:6},{label:"其他",value:7}],selectoptions:{},modalDisplay:!1,modalForm:{},modalEditDisplay:!1,modalEditForm:{},searchFormData:{model:"app.PurchaseTable",purchase_date__range:[]},gridOptions:{resizable:!0,height:1100,showOverflow:!0,border:"inner",rowId:"id",rowConfig:{isHover:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:50,pageSizes:[50,50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page,o=(t.sorts,t.filters,{action:"attachment_file_view",subaction:"purchasetable_query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.searchFormData});return Object(u["b"])(o)}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"checkbox",width:60},{type:"seq",title:"序号",width:"60",align:"center"},{field:"attachmentid",title:"ID",visible:!1},{field:"supplier_name",title:"供应商"},{field:"purchase_number",title:"采购单号",align:"center",width:200},{field:"purchase_date",title:"采购日期",align:"center",width:200},{field:"filename",title:"文件名",sortable:!0},{field:"stored_name",title:"新文件名",visible:!1},{field:"upload_time",title:"上传时间",sortable:!0,align:"center"},{field:"file_size",title:"大小",align:"center",formatter:function(e){var t=e.cellValue;return null==t||""===t?"":(t/1048576).toFixed(2)+" MB"}},{field:"purchaser",title:"采购员",align:"center"}]}}},created:function(){},mounted:function(){window.addEventListener("beforeunload",this.releaseLock)},beforeDestroy:function(){window.removeEventListener("beforeunload",this.releaseLock)},methods:{handleCurrentChange:function(e){var t=e.row;this.currentRow=t},getSelectedRow:function(){return this.currentRow?this.currentRow:(c["VXETable"].modal.message({content:"请先单击选择一行",status:"warning"}),null)},localOpenHandle:function(){var e=this.getSelectedRow();e&&this.openLocalFile(e)},dowloadFileHandle:function(){var e=this.getSelectedRow();e&&this.downloadFileRow(e)},editRowHandle:function(){var e=this.getSelectedRow();e&&this.editName(e)},deleteRowHandle:function(){var e=this.getSelectedRow();e&&this.remove(e)},openLocalFile:function(e){var t=arguments,a=this;return Object(l["a"])(Object(r["a"])().mark((function o(){var n,l,u,p,f,b,v,h,x,_,g,y,w;return Object(r["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(l=t.length>1&&void 0!==t[1]&&t[1],null!==(n=e)&&void 0!==n&&n.row&&(e=e.row),u=e.stored_name,u){o.next=6;break}return c["VXETable"].modal.message({content:"记录里没有文件名",status:"error"}),o.abrupt("return");case 6:return p=s["Loading"].service({lock:!0,text:"文件打开中…",spinner:"el-icon-loading",background:"rgba(0,0,0,0.15)"}),f=d+e.object_id+"\\"+u,a.lastOpenedPath=l?"":f,o.prev=9,v=500,o.next=13,Promise.all([fetch("".concat(m,"/open"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:f,readonly:l,user:(null===(b=a.$store)||void 0===b?void 0:b.state.userName)||"LiLin"})}),new Promise((function(e){return setTimeout(e,v)}))]);case 13:if(h=o.sent,x=Object(i["a"])(h,1),_=x[0],200!==_.status){o.next=18;break}return o.abrupt("return");case 18:if(423!==_.status){o.next=27;break}return o.next=21,_.json();case 21:return g=o.sent,y=g.lock_info,w="".concat(y.user," @ ").concat(y.host," 正在编辑。\n要只读打开吗？"),o.next=26,a.$confirm(w,"文件被占用",{confirmButtonText:"只读打开",cancelButtonText:"取消",type:"warning"});case 26:return o.abrupt("return",a.openLocalFile(e,!0));case 27:return o.t0=Error,o.next=30,_.text();case 30:throw o.t1=o.sent,new o.t0(o.t1);case 34:o.prev=34,o.t2=o["catch"](9),c["VXETable"].modal.message({content:"打开失败："+(o.t2.message||"请检查本地助手是否已启动"),status:"error"});case 37:return o.prev=37,p.close(),o.finish(37);case 40:case"end":return o.stop()}}),o,null,[[9,34,37,40]])})))()},releaseLock:function(){this.lastOpenedPath&&fetch("".concat(m,"/release"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:this.lastOpenedPath})}).catch((function(){}))},withLoading:function(e){var t=s["Loading"].service({lock:!0,text:"生成中，请稍候…",background:"rgba(0, 0, 0, 0.4)"});return e().finally((function(){return t.close()}))},batchDownload:function(e){var t=this;return Object(l["a"])(Object(r["a"])().mark((function e(){var a,o,n;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.$refs.xGrid,o=a.getCheckboxRecords(),o.length){e.next=5;break}return c["VXETable"].modal.message({content:"请先勾选要下载的附件",status:"warning"}),e.abrupt("return");case 5:n=o.map((function(e){return e.attachmentid})),console.log(n),t.withLoading(Object(l["a"])(Object(r["a"])().mark((function e(){var a,o;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u["a"])({action:"attachment_file_view",subaction:"batch_download",ids:n},{responseType:"blob",timeout:0});case 3:a=e.sent,o="attachments.zip",c["VXETable"].saveFile({filename:o,type:"zip",content:a.data}),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$message.error("下载失败");case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))));case 8:case"end":return e.stop()}}),e)})))()},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},resetEvent:function(){this.searchFormData={},this.$refs.xGrid.commitProxy("reload")},downloadFileRow:function(e){var t=this;this.withLoading(Object(l["a"])(Object(r["a"])().mark((function t(){var a,o,n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["a"])({action:"attachment_file_view",subaction:"download",id:e.attachmentid},{responseType:"blob",noCodeCheck:!0});case 2:a=t.sent,o=e.filename.split(".").pop(),n=e.filename.replace(new RegExp("\\.".concat(o,"$"),"i"),""),c["VXETable"].saveFile({filename:n,type:o,content:a.data});case 6:case"end":return t.stop()}}),t)})))).catch((function(){t.$message.error("下载失败")}))}}},f=p,b=a("2877"),v=Object(b["a"])(f,o,n,!1,null,null,null);t["default"]=v.exports}}]);