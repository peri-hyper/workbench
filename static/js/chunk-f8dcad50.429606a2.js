(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f8dcad50"],{"4e82":function(e,t,a){"use strict";var r=a("23e7"),n=a("1c0b"),o=a("7b0b"),i=a("d039"),l=a("a640"),s=[],u=s.sort,c=i((function(){s.sort(void 0)})),d=i((function(){s.sort(null)})),m=l("sort"),p=c||!d||!m;r({target:"Array",proto:!0,forced:p},{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),n(e))}})},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,o=a("44d2"),i=a("ae40"),l="find",s=!0,u=i(l);l in[]&&Array(1)[l]((function(){s=!1})),r({target:"Array",proto:!0,forced:s||!u},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),o(l)},d96b:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var r=a("b775");function n(e){return Object(r["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/vue-element-admin/backend/download_file/",method:"get",params:e})}},dd79:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDivVisible,expression:"isDivVisible"}]},[a("h3",[e._v(" 采购申请 ")]),a("vxe-grid",e._b({ref:"xGrid",attrs:{"checkbox-config":{checkField:"isChecked",highlight:!0,range:!0}},on:{"checkbox-change":e.handleCheckboxChange,"checkbox-range-end":e.handleCheckboxRangeChange,"checkbox-all":e.handleCheckAll},scopedSlots:e._u([{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.searchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{field:"product_name",title:"产品名称","item-render":{name:"input",attrs:{placeholder:""}}}}),a("vxe-form-item",{attrs:{title:"采购状态"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.searchFormData.whether_buy,callback:function(t){e.$set(e.searchFormData,"whether_buy",t)},expression:"searchFormData.whether_buy"}},e._l(e.whether_buy_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.addRow()}}},[e._v("新增")]),a("vxe-button",{attrs:{status:"danger"},on:{click:function(t){return e.deleteAll()}}},[e._v("批量删除")])]},proxy:!0},{key:"operation",fn:function(t){var r=t.row;return[a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.editRow(r)}}},[e._v("编辑")]),a("vxe-button",{attrs:{status:"danger"},on:{click:function(t){return e.deleteRow(r)}}},[e._v("删除")])]}},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptions,!1)),a("vxe-modal",{attrs:{title:"新增",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalDisplay,callback:function(t){e.modalDisplay=t},expression:"modalDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalSubmitEvent}},[a("vxe-form-item",{attrs:{title:"产品名称",span:24}},[a("vxe-input",{model:{value:e.modalForm.product_name,callback:function(t){e.$set(e.modalForm,"product_name",t)},expression:"modalForm.product_name"}})],1),a("vxe-form-item",{attrs:{title:"产品规格",span:24}},[a("vxe-input",{model:{value:e.modalForm.product_size,callback:function(t){e.$set(e.modalForm,"product_size",t)},expression:"modalForm.product_size"}})],1),a("vxe-form-item",{attrs:{title:"单位",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalForm.unit,callback:function(t){e.$set(e.modalForm,"unit",t)},expression:"modalForm.unit"}},e._l(e.unit_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"数量",span:24}},[a("vxe-input",{model:{value:e.modalForm.quantity,callback:function(t){e.$set(e.modalForm,"quantity",t)},expression:"modalForm.quantity"}})],1),a("vxe-form-item",{attrs:{title:"品牌",span:24}},[a("vxe-input",{model:{value:e.modalForm.brand,callback:function(t){e.$set(e.modalForm,"brand",t)},expression:"modalForm.brand"}})],1),a("vxe-form-item",{attrs:{title:"材质",span:24}},[a("vxe-input",{model:{value:e.modalForm.material_certificate,callback:function(t){e.$set(e.modalForm,"material_certificate",t)},expression:"modalForm.material_certificate"}})],1),a("vxe-form-item",{attrs:{title:"类型",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalForm.material_type,callback:function(t){e.$set(e.modalForm,"material_type",t)},expression:"modalForm.material_type"}},e._l(e.material_type_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalForm.remark,callback:function(t){e.$set(e.modalForm,"remark",t)},expression:"modalForm.remark"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("vxe-modal",{attrs:{title:"编辑",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalEditDisplay,callback:function(t){e.modalEditDisplay=t},expression:"modalEditDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalEditSubmitEvent}},[a("vxe-form-item",{attrs:{title:"产品名称",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.product_name,callback:function(t){e.$set(e.modalEditForm,"product_name",t)},expression:"modalEditForm.product_name"}})],1),a("vxe-form-item",{attrs:{title:"产品规格",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.product_size,callback:function(t){e.$set(e.modalEditForm,"product_size",t)},expression:"modalEditForm.product_size"}})],1),a("vxe-form-item",{attrs:{title:"单位",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalEditForm.unit,callback:function(t){e.$set(e.modalEditForm,"unit",t)},expression:"modalEditForm.unit"}},e._l(e.unit_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"数量",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.quantity,callback:function(t){e.$set(e.modalEditForm,"quantity",t)},expression:"modalEditForm.quantity"}})],1),a("vxe-form-item",{attrs:{title:"品牌",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.brand,callback:function(t){e.$set(e.modalEditForm,"brand",t)},expression:"modalEditForm.brand"}})],1),a("vxe-form-item",{attrs:{title:"材质",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.material_certificate,callback:function(t){e.$set(e.modalEditForm,"material_certificate",t)},expression:"modalEditForm.material_certificate"}})],1),a("vxe-form-item",{attrs:{title:"类型",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.modalEditForm.material_type,callback:function(t){e.$set(e.modalEditForm,"material_type",t)},expression:"modalEditForm.material_type"}},e._l(e.material_type_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.remark,callback:function(t){e.$set(e.modalEditForm,"remark",t)},expression:"modalEditForm.remark"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalEditDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("h3",[e._v(" 修改采购单(采购单号："+e._s(e.current_purchase_number)+") ")]),a("vxe-form",{attrs:{"title-align":"right","title-width":"100"}},[a("vxe-form-item",{attrs:{title:"采购员",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.username_options,clearable:"",filterable:""},model:{value:e.modalFormIn.username_id,callback:function(t){e.$set(e.modalFormIn,"username_id",t)},expression:"modalFormIn.username_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"供应商",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.supplier_name_options,clearable:"",filterable:""},model:{value:e.modalFormIn.supplier_name_id,callback:function(t){e.$set(e.modalFormIn,"supplier_name_id",t)},expression:"modalFormIn.supplier_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系人",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalFormIn.contact_person,callback:function(t){e.$set(e.modalFormIn,"contact_person",t)},expression:"modalFormIn.contact_person"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系方式",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalFormIn.contact_number,callback:function(t){e.$set(e.modalFormIn,"contact_number",t)},expression:"modalFormIn.contact_number"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"日期",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalFormIn.purchase_date,callback:function(t){e.$set(e.modalFormIn,"purchase_date",t)},expression:"modalFormIn.purchase_date"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"币种",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.currency_options,clearable:"",filterable:""},model:{value:e.modalFormIn.currency,callback:function(t){e.$set(e.modalFormIn,"currency",t)},expression:"modalFormIn.currency"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"备注",span:6},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{model:{value:e.modalFormIn.remark,callback:function(t){e.$set(e.modalFormIn,"remark",t)},expression:"modalFormIn.remark"}})]},proxy:!0}])})],1),a("vxe-toolbar",{ref:"xToolbar",scopedSlots:e._u([{key:"buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary",content:"新增"},on:{click:e.insertEvent}}),a("vxe-button",{attrs:{status:"primary",content:"修改采购单"},on:{click:e.generatePurchase}})]},proxy:!0}])}),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","show-overflow":"","keep-source":"",data:e.purchaseTableData,"edit-config":{trigger:"click",mode:"cell",showUpdateStatus:!0,showInsertStatus:!0}},on:{"edit-closed":e.handleEditClosed}},[a("vxe-column",{attrs:{type:"seq",width:"60",title:"序号"}}),a("vxe-column",{attrs:{field:"product_name",title:"名称","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_name,callback:function(t){e.$set(r,"product_name",t)},expression:"row.product_name"}})]}}])}),a("vxe-column",{attrs:{field:"product_size",title:"规格","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.product_size,callback:function(t){e.$set(r,"product_size",t)},expression:"row.product_size"}})]}}])}),a("vxe-column",{attrs:{field:"unit_label",title:"单位","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.unit_label,callback:function(t){e.$set(r,"unit_label",t)},expression:"row.unit_label"}})]}}])}),a("vxe-column",{attrs:{field:"quantity",title:"数量","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{focus:function(t){return e.ClearRow2(r)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnterUp(r,e.column=3)}},model:{value:r.quantity,callback:function(t){e.$set(r,"quantity",t)},expression:"row.quantity"}})]}}])}),a("vxe-column",{attrs:{field:"unit_price",title:"单价","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},on:{focus:function(t){return e.ClearRow(r)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnterUp(r,e.column=4)}},model:{value:r.unit_price,callback:function(t){e.$set(r,"unit_price",t)},expression:"row.unit_price"}})]}}])}),a("vxe-column",{attrs:{field:"total_prices",title:"总价","edit-render":{autofocus:".vxe-input--inner",defaultValue:"0"}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.total_prices,callback:function(t){e.$set(r,"total_prices",t)},expression:"row.total_prices"}})]}}])}),a("vxe-column",{attrs:{field:"remark",title:"备注","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.remark,callback:function(t){e.$set(r,"remark",t)},expression:"row.remark"}})]}}])}),a("vxe-column",{attrs:{title:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("vxe-button",{attrs:{status:"danger",content:"删除"},on:{click:function(t){return e.removeRowEvent(r)}}})]}}])})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isDivVisible,expression:"!isDivVisible"}]},[a("h4",[e._v("提示：请先到采购单管理页选择要编辑的采购单。")])])])},n=[],o=a("c7eb"),i=a("1da1"),l=a("2909"),s=a("b85c"),u=a("5530"),c=(a("99af"),a("7db0"),a("c740"),a("d81d"),a("4e82"),a("a434"),a("d3b7"),a("159b"),a("a388")),d=a("d96b"),m={data:function(){var e=this;return{isDivVisible:!1,current_purchase_number:"",currency_options:[{label:"HKD",value:"HKD"},{label:"CNY",value:"CNY"},{label:"USD",value:"USD"}],modalFormIn:{purchase_date:""},purchaseTableData:[],unit_options:[{label:"件",value:"1"},{label:"套",value:"2"},{label:"批",value:"3"},{label:"千克",value:"4"},{label:"吨",value:"5"},{label:"包",value:"6"},{label:"盒",value:"7"},{label:"其他",value:"8"}],material_type_options:[{label:"原材料",value:"1"},{label:"焊材",value:"2"},{label:"耗材",value:"3"},{label:"工具",value:"4"},{label:"配件",value:"5"},{label:"螺丝",value:"6"},{label:"钻铣",value:"7"}],selectoptions:{},modalDisplay:!1,modalForm:{},modalEditDisplay:!1,modalEditForm:{},whether_buy_options:[{label:"已采购",value:1},{label:"待采购",value:2}],searchFormData:{whether_buy:2},gridOptions:{resizable:!0,showOverflow:!0,height:500,border:"inner",rowId:"id",rowConfig:{isHover:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:100,pageSizes:[50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page,r=(t.sorts,t.filters,{action:"request_buy_table_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.searchFormData});return Object(d["a"])(r).then((function(t){var a=t.data||[],r=a.map((function(e){return Object(u["a"])(Object(u["a"])({},e),{},{isChecked:!1})})),n=e.purchaseTableData;console.log(r),console.log(e.purchaseTableData);var o,i=Object(s["a"])(n);try{var l=function(){var e=o.value,t=r.findIndex((function(t){return t.requestid===e.requestid_id||t.requestid===e.requestid}));-1!==t&&(r[t].isChecked=!0)};for(i.s();!(o=i.n()).done;)l()}catch(c){i.e(c)}finally{i.f()}return{data:r,total:t.total}}))}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"seq",title:"序号"},{type:"checkbox",title:"选择"},{field:"requestid",title:"ID",visible:!1},{field:"product_name",title:"产品名称"},{field:"product_size",title:"产品规格"},{field:"material",title:"材质"},{field:"quantity",title:"数量"},{field:"unit",title:"单位"},{field:"unit_price",title:"单价"},{field:"total_price",title:"总价"},{field:"username_id",title:"申请人"},{field:"requestdate",title:"申请时间"},{field:"whether_buy",title:"是否采购",visible:!1},{field:"whether_buy_label",title:"是否采购"},{field:"remarks",title:"备注"},{title:"操作",showOverflow:!0,width:"160px",fixed:"right",slots:{default:"operation"}}]}}},created:function(){},mounted:function(){this.getOptions(),this.current_purchase_number=this.$route.query.purchase_number,void 0===this.current_purchase_number?(this.current_purchase_number="",this.isDivVisible=!1):(this.isDivVisible=!0,this.getPurchaseTableData(),this.getPurchaseDetail())},methods:{handleCellClicked:function(e){var t=e.row,a=e.column;this.$refs.xTable.triggerEdit(t,a)},handleCheckAll:function(){var e,t=this,a=this.$refs.xGrid.getTableData().fullData,r=[],n=[];a.forEach((function(e,a){var o=t.purchaseTableData.findIndex((function(t){return t.requestid===e.requestid}));if(n.push(o),!0===e.isChecked){var i={requestid:e.requestid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit,quantity:e.quantity,unit_price:e.unit_price,total_prices:e.total_price,remark:e.remarks};r.push(i)}})),(e=this.purchaseTableData).push.apply(e,r),n.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&t.purchaseTableData.splice(e,1)}))},handleCheckboxRangeChange:function(e){var t,a=this,r=(e.$event,this.$refs.xGrid.getTableData().fullData),n=[],o=[];r.forEach((function(e,t){var r=a.purchaseTableData.findIndex((function(t){return t.requestid===e.requestid}));if(o.push(r),!0===e.isChecked){var i={requestid:e.requestid,isChecked:e.isChecked,product_name:e.product_name,product_size:e.product_size,unit_label:e.unit,quantity:e.quantity,unit_price:e.unit_price,total_prices:e.total_price,remark:e.remarks};n.push(i)}})),(t=this.purchaseTableData).push.apply(t,n),o.sort((function(e,t){return t-e})).forEach((function(e){-1!==e&&a.purchaseTableData.splice(e,1)}))},deleteAll:function(){var e=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){var t=e.$refs.xGrid.getCheckboxRecords();console.log(t);var a=[];t.forEach((function(t){var r=e.purchaseTableData.findIndex((function(e){return e.inventoryid===t.inventoryid}));e.purchaseTableData.splice(r,1),a.push(t.requestid)}));var r={action:"request_buy_table_view",subaction:"batchDelete",requestid_list:a};Object(d["a"])(r).then((function(t){c["VXETable"].modal.message({content:"删除成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))}))},ClearRow:function(e){console.log(e),"0.00"!==e.unit_price&&0!==e.unit_price||(e.unit_price="")},ClearRow2:function(e){0===e.quantity&&(e.quantity="")},onEnterUp:function(e,t,a){var r=this,n=this.purchaseTableData.indexOf(e),o=n+1;if(o<this.purchaseTableData.length)this.$nextTick((function(){var e=0;e=0===n?6+t:6+t+7*n;var a=r.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[e];a&&a.click()}));else{var i=this.$refs.xTable.$el.querySelectorAll(".vxe-cell--label")[t];console.warn(i),i&&(console.warn("找到数据"),i.click(),i.focus()),console.warn("No next row available")}},getPurchaseDetail:function(){var e=this,t={action:"purchase_detail_table_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{purchase_number:this.current_purchase_number}};Object(d["a"])(t).then((function(t){e.purchaseTableData=t.data,e.purchaseTableData.forEach((function(e){e.unit_label=e.unit,e.total_prices=e.total_price}))}))},getPurchaseTableData:function(){var e=this,t={action:"purchase_table_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{purchase_number:this.current_purchase_number}};Object(d["a"])(t).then((function(t){e.modalFormIn=t.data[0]}))},handleEditClosed:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column,e.columnIndex);e.$columnIndex;4!==a&&5!==a||(t.total_prices=t.quantity*t.unit_price)},generatePurchase:function(){if(""!==this.modalFormIn.username_id&&""!==this.modalFormIn.supplier_name_id&&""!==this.modalFormIn.contact_person&&""!==this.modalFormIn.contact_number&&""!==this.modalFormIn.purchase_date&&""!==this.modalFormIn.currency&&0!==this.purchaseTableData.length){console.log(this.purchaseTableData);var e=this.purchaseTableData.findIndex((function(e){return""===e.quantity||isNaN(e.quantity)||e.quantity<0||null===e.unit_price||""===e.unit_price||isNaN(e.unit_price)||e.unit_price<0||null===e.total_prices||""===e.total_prices||isNaN(e.total_prices)||e.total_prices<0}));if(-1===e){var t=this.$refs.xTable,a=t.getRecordset(),r=a.insertRecords,n=[].concat(Object(l["a"])(r),Object(l["a"])(this.purchaseTableData)),o={action:"complex_view",subaction:"generate_purchase_order_modify",tabledata:n,formdata:Object(u["a"])(Object(u["a"])({},this.modalFormIn),{},{purchase_number:this.current_purchase_number})};Object(d["a"])(o).then((function(e){0===e.code?c["VXETable"].modal.message({content:"修改成功",status:"success"}):c["VXETable"].modal.message({content:"修改失败:{response.msg}",status:"error"})}))}else c["VXETable"].modal.message({content:"发货数量或者单价不可为空,或者必须为数字。",status:"warning"})}else c["VXETable"].modal.message({content:"请填写完整信息",status:"error"})},insertEvent:function(){var e=this;return Object(i["a"])(Object(o["a"])().mark((function t(){var a,r,n,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.xTable,r={},t.next=4,a.insert(r);case 4:return n=t.sent,i=n.row,t.next=8,a.setEditRow(i);case 8:case"end":return t.stop()}}),t)})))()},removeRowEvent:function(e){var t=this;return Object(i["a"])(Object(o["a"])().mark((function a(){var r,n,i,l;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:console.log(e),r=e.requestid_id,console.log(r),n=t.purchaseTableData.findIndex((function(e){return e.requestid_id===r})),t.purchaseTableData.splice(n,1),i=t.$refs.xGrid.getTableData().fullData.find((function(e){return e.requestid===r})),i&&(l=t.$refs.xGrid.getTableData().fullData.findIndex((function(e){return e.requestid===r})),t.$refs.xGrid.getTableData().fullData[l].isChecked=!1);case 7:case"end":return a.stop()}}),a)})))()},handleCheckboxChange:function(e){var t=e.row,a=(e.rowIndex,e.checked);if(!0===a){var r={requestid:t.requestid,isChecked:t.isChecked,product_name:t.product_name,product_size:t.product_size,unit_label:t.unit,quantity:t.quantity,unit_price:t.unit_price,total_prices:t.total_price,remark:t.remarks};this.purchaseTableData.push(r)}else{var n=this.purchaseTableData.findIndex((function(e){return e.requestid===t.requestid}));console.log(n),this.purchaseTableData.splice(n,1)}},getOptions:function(){var e=this,t={action:"warehous_entry_table_view",subaction:"getOptions"};Object(d["a"])(t).then((function(t){e.selectoptions=t.data}))},addRow:function(){this.modalForm={},this.modalDisplay=!0},modalSubmitEvent:function(){var e=this,t={action:"inventory_table_view",subaction:"addRecord",modalForm:this.modalForm};Object(d["a"])(t).then((function(t){e.modalDisplay=!1,c["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},deleteRow:function(e){var t=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((function(){var a=t.$refs.xGrid.$data["tableData"];for(var r in a)e.id===a[r].id&&a.splice(r,1);var n={action:"inventory_table_view",subaction:"deleteRecord",idmap:{purchaseid:e.purchaseid}};Object(d["a"])(n).then((function(e){c["VXETable"].modal.message({content:"删除成功",status:"success"}),t.$refs.xGrid.commitProxy("reload")}))}))},editRow:function(e){this.modalEditDisplay=!0,this.modalEditForm=e;var t=a("2ef0");this.modalEditForm=t.cloneDeep(e),delete this.modalEditForm.id,delete this.modalEditForm.unit_label,delete this.modalEditForm.material_type_label},modalEditSubmitEvent:function(){var e=this,t={action:"inventory_table_view",subaction:"editRecord",modalEditForm:this.modalEditForm,idmap:{inventoryid:this.modalEditForm.inventoryid}};Object(d["a"])(t).then((function(t){e.modalEditDisplay=!1,c["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},resetEvent:function(){this.searchFormData={},this.$refs.xGrid.commitProxy("reload")}}},p=m,f=a("2877"),v=Object(f["a"])(p,r,n,!1,null,null,null);t["default"]=v.exports}}]);