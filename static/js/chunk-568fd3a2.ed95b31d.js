(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-568fd3a2"],{"0128":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"0 50px 0 50px"}},[a("vxe-grid",e._b({ref:"xGrid",attrs:{"checkbox-config":{highlight:!0,range:!0},"highlight-current-row":""},on:{"current-change":e.handleCurrentChange,"toggle-row-expand":e.handleToggleExpand,"cell-dblclick":e.queryDataHandle},scopedSlots:e._u([{key:"search_buttons",fn:function(){return[a("vxe-form",{attrs:{data:e.purchasesearchFormData},on:{submit:e.searchEvent,reset:e.resetEvent}},[a("vxe-form-item",{attrs:{title:"供应商名称"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-input",{attrs:{placeholder:"请输入"},model:{value:e.purchasesearchFormData.search_data,callback:function(t){e.$set(e.purchasesearchFormData,"search_data",t)},expression:"purchasesearchFormData.search_data"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"日期查询"},scopedSlots:e._u([{key:"default",fn:function(){return[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:e.shortcuts,size:e.size},model:{value:e.purchasesearchFormData.purchase_date__range,callback:function(t){e.$set(e.purchasesearchFormData,"purchase_date__range",t)},expression:"purchasesearchFormData.purchase_date__range"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"到货状态"},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请选择"},model:{value:e.purchasesearchFormData.AOG_status,callback:function(t){e.$set(e.purchasesearchFormData,"AOG_status",t)},expression:"purchasesearchFormData.AOG_status"}},e._l(e.aog_options,(function(e,t){return a("vxe-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}])}),a("vxe-form-item",{attrs:{"item-render":{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}})],1)]},proxy:!0},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.addRow()}}},[e._v("新增采购")]),a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.editRowHandle()}}},[e._v("编辑")]),a("vxe-button",{attrs:{status:"danger"},on:{click:function(t){return e.deleteRowHandle()}}},[e._v("删除")]),a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.dowloadFileHandle()}}},[e._v("下载PDF")]),a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.downloadExcelHandle()}}},[e._v("下载Excel")]),a("vxe-button",{attrs:{status:"warning"},on:{click:function(t){return e.batchPurchaseDownload("pdf")}}},[e._v("批量下载 PDF")]),a("vxe-button",{attrs:{status:"warning"},on:{click:function(t){return e.batchPurchaseDownload("excel")}}},[e._v("批量下载 Excel")]),a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.ChangeloadRowHandle()}}},[e._v("到货")])]},proxy:!0},{key:"operation1",fn:function(t){var r=t.row;return[a("span",{domProps:{innerHTML:e._s(e.renderAOGStatus(r.AOG_status_label))}})]}},{key:"expandContent",fn:function(t){var r=t.row;return[a("div",{staticClass:"expand-container",staticStyle:{padding:"12px",background:"#f9fafb",border:"1px solid #ebeef5"}},[a("div",{staticStyle:{display:"flex",gap:"16px"}},[a("div",{staticStyle:{flex:"1","min-width":"480px"}},[a("h4",{staticClass:"mb-2"},[e._v("采购明细（单号："+e._s(r.purchase_number)+"）")]),a("vxe-grid",{key:r._shipLoaded,ref:"gridShip_"+r.purchase_number,attrs:{data:r._ship||[],columns:e.purchaseColumns,"highlight-current-row":"","keep-source":"",size:"mini",height:"300","show-overflow":""}})],1),a("div",{staticStyle:{flex:"1","min-width":"360px"}},[a("div",{staticClass:"mb-2 flex items-center"},[a("div",{staticStyle:{display:"flex","align-items":"center",gap:"25px"}},[a("h4",{staticClass:"mr-2"},[e._v("附件列表")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.batchDownload(r)}}},[e._v(" 批量下载 ")])],1)]),a("vxe-grid",{key:r._attachLoaded,ref:"gridAttach_"+r.purchase_number,attrs:{data:r._attach||[],columns:e.attachmentColumns,"checkbox-config":{highlight:!0,range:!0},"highlight-current-row":"","keep-source":"",size:"mini",height:"300","show-overflow":""}})],1)])])]}},{key:"empty",fn:function(){return[a("span",{},[a("p",[e._v("没有数据！")])])]},proxy:!0}])},"vxe-grid",e.gridOptions,!1)),a("vxe-modal",{attrs:{title:"新增",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalDisplay,callback:function(t){e.modalDisplay=t},expression:"modalDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalSubmitEvent}},[a("vxe-form-item",{attrs:{title:"采购单号",span:24}},[a("vxe-input",{model:{value:e.modalForm.purchase_number,callback:function(t){e.$set(e.modalForm,"purchase_number",t)},expression:"modalForm.purchase_number"}})],1),a("vxe-form-item",{attrs:{title:"采购员",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.username_options,clearable:"",filterable:""},model:{value:e.modalForm.username_id,callback:function(t){e.$set(e.modalForm,"username_id",t)},expression:"modalForm.username_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"供应商名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.supplier_name_options,clearable:"",filterable:""},model:{value:e.modalForm.supplier_name_id,callback:function(t){e.$set(e.modalForm,"supplier_name_id",t)},expression:"modalForm.supplier_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系人",span:24}},[a("vxe-input",{model:{value:e.modalForm.contact_person,callback:function(t){e.$set(e.modalForm,"contact_person",t)},expression:"modalForm.contact_person"}})],1),a("vxe-form-item",{attrs:{title:"联系方式",span:24}},[a("vxe-input",{model:{value:e.modalForm.contact_number,callback:function(t){e.$set(e.modalForm,"contact_number",t)},expression:"modalForm.contact_number"}})],1),a("vxe-form-item",{attrs:{title:"采购日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalForm.purchase_date,callback:function(t){e.$set(e.modalForm,"purchase_date",t)},expression:"modalForm.purchase_date"}})],1),a("vxe-form-item",{attrs:{title:"币种",span:24}},[a("vxe-input",{model:{value:e.modalForm.currency,callback:function(t){e.$set(e.modalForm,"currency",t)},expression:"modalForm.currency"}})],1),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalForm.remark,callback:function(t){e.$set(e.modalForm,"remark",t)},expression:"modalForm.remark"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1),a("vxe-modal",{attrs:{title:"请选择到货状态",width:"200",resize:"","destroy-on-close":""},model:{value:e.modalDisplayPrint,callback:function(t){e.modalDisplayPrint=t},expression:"modalDisplayPrint"}},[a("el-form",{staticClass:"form"},[a("el-row",{staticStyle:{width:"100%"}},[a("el-radio-group",{staticStyle:{"text-align":"center"},model:{value:e.selectedOption.AOG_status,callback:function(t){e.$set(e.selectedOption,"AOG_status",t)},expression:"selectedOption.AOG_status"}},[a("el-row",[a("el-col",[a("el-form-item",[a("el-radio",{attrs:{label:"已到货"}},[e._v("已到货")])],1)],1),a("el-col",[a("el-form-item",[a("el-radio",{attrs:{label:"未到货"}},[e._v("未到货")])],1)],1)],1)],1)],1),a("el-row",{staticStyle:{"text-align":"center"}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalDisplayPrint=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"},on:{click:e.EnterChangeloadRow}},[e._v("确认")])],1)],1)],1),a("vxe-modal",{attrs:{title:"编辑",width:"500",resize:"","destroy-on-close":""},model:{value:e.modalEditDisplay,callback:function(t){e.modalEditDisplay=t},expression:"modalEditDisplay"}},[a("vxe-form",{attrs:{"title-align":"right","title-width":"100"},on:{submit:e.modalEditSubmitEvent}},[a("vxe-form-item",{attrs:{title:"采购单号",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.purchase_number,callback:function(t){e.$set(e.modalEditForm,"purchase_number",t)},expression:"modalEditForm.purchase_number"}})],1),a("vxe-form-item",{attrs:{title:"采购员",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.username_options,clearable:"",filterable:""},model:{value:e.modalEditForm.username_id,callback:function(t){e.$set(e.modalEditForm,"username_id",t)},expression:"modalEditForm.username_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"供应商名称",span:24},scopedSlots:e._u([{key:"default",fn:function(){return[a("vxe-select",{attrs:{placeholder:"请搜索",options:e.selectoptions.supplier_name_options,clearable:"",filterable:""},model:{value:e.modalEditForm.supplier_name_id,callback:function(t){e.$set(e.modalEditForm,"supplier_name_id",t)},expression:"modalEditForm.supplier_name_id"}})]},proxy:!0}])}),a("vxe-form-item",{attrs:{title:"联系人",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.contact_person,callback:function(t){e.$set(e.modalEditForm,"contact_person",t)},expression:"modalEditForm.contact_person"}})],1),a("vxe-form-item",{attrs:{title:"联系方式",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.contact_number,callback:function(t){e.$set(e.modalEditForm,"contact_number",t)},expression:"modalEditForm.contact_number"}})],1),a("vxe-form-item",{attrs:{title:"采购日期",span:24}},[a("vxe-input",{attrs:{type:"date",placeholder:"请选择日期",clearable:""},model:{value:e.modalEditForm.purchase_date,callback:function(t){e.$set(e.modalEditForm,"purchase_date",t)},expression:"modalEditForm.purchase_date"}})],1),a("vxe-form-item",{attrs:{title:"币种",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.currency,callback:function(t){e.$set(e.modalEditForm,"currency",t)},expression:"modalEditForm.currency"}})],1),a("vxe-form-item",{attrs:{title:"备注",span:24}},[a("vxe-input",{model:{value:e.modalEditForm.remark,callback:function(t){e.$set(e.modalEditForm,"remark",t)},expression:"modalEditForm.remark"}})],1),a("vxe-form-item",{attrs:{align:"center","title-align":"center",span:24}},[a("vxe-button",{attrs:{type:"reset"},on:{click:function(t){e.modalEditDisplay=!1}}},[e._v("取消")]),a("vxe-button",{attrs:{type:"submit",status:"primary"}},[e._v("提交")])],1)],1)],1)],1)},n=[],o=a("b85c"),s=a("3835"),i=a("c7eb"),c=a("1da1"),l=a("5530"),u=(a("99af"),a("4de4"),a("7db0"),a("caad"),a("d81d"),a("fb6a"),a("b0c0"),a("e9c4"),a("b680"),a("b64b"),a("d3b7"),a("4d63"),a("ac1f"),a("2c3e"),a("25f0"),a("2532"),a("3ca3"),a("5319"),a("0643"),a("2382"),a("fffc"),a("4e3e"),a("a573"),a("159b"),a("ddb0"),a("a388")),d=a("d96b"),p=a("2f62");a("498a");function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;return e.replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim().slice(0,t)+"…"}var h=a("5c96"),f="O:\\producterp\\producterp\\attachments\\purchasetable\\",b="http://127.0.0.1:3210",v={computed:Object(l["a"])({},Object(p["b"])(["sidebar","avatar","device","name","purchasesearchFormData","select_row_number","list_scroll_top","list_current_page","expanded_rows"])),data:function(){var e=this,t=this.$createElement;return{batchShippingIds:[],batchType:"",modalDisplayPrint:!1,selectedOption:{AOG_status:""},aog_options:[{label:"未到货",value:1},{label:"已到货",value:2}],current_purchase_number:"",selectoptions:{},modalDisplay:!1,modalForm:{},modalEditDisplay:!1,modalEditForm:{},gridOptions:{resizable:!0,showOverflow:!0,border:"inner",rowId:"id",height:1100,rowConfig:{isHover:!0},filterConfig:{remote:!0},pagerConfig:{pageSize:35,pageSizes:[35,50,100,500],layouts:["PrevJump","PrevPage","JumpNumber","NextPage","NextJump","Sizes","FullJump","Total"]},proxyConfig:{seq:!0,sort:!0,filter:!0,props:{list:"data",result:"data",total:"total"},ajax:{query:function(t){var a=t.page,r=(t.sorts,t.filters,{action:"purchase_table_view",subaction:"query",pageNum:a.currentPage,pageSize:a.pageSize,searchForm:e.purchasesearchFormData});return console.log(e.purchasesearchFormData),Object(d["b"])(r)}}},formConfig:{titleWidth:100,titleAlign:"right",items:[{slots:{default:"search_buttons"}}]},toolbarConfig:{slots:{buttons:"toolbar_buttons"}},columns:[{type:"checkbox",width:60},{type:"seq",title:"序号",width:60,align:"center"},{type:"expand",width:40,align:"center",showOverflow:!1,className:"bg-white pl-2",slots:{content:"expandContent"}},{field:"purchaseid",title:"ID",visible:!1},{field:"purchase_number",title:"采购单号",align:"center"},{field:"username_id",title:"采购员",align:"center"},{field:"supplier_name_id",title:"供应商名称",width:280},{field:"contact_person",title:"联系人",align:"center"},{field:"contact_number",title:"联系方式"},{field:"purchase_date",title:"采购日期",align:"center"},{field:"currency",title:"币种",align:"center"},{field:"remark",title:"备注",align:"center",formatter:function(t){var a=t.cellValue;return e.formatRemark(a)}},{field:"AOG_status",title:"到货状态",width:100,align:"center",formatter:function(e){var t=e.row;return 1===t.AOG_status?"未到货":"已到货"},className:function(e){var t=e.row;return 1===t.AOG_status?"aog-red":"aog-green"}}]},purchaseColumns:[{type:"seq",title:"序号",width:60,align:"center"},{field:"requestid",title:"ID",visible:!1},{field:"product_name",title:"产品名称",align:"center"},{field:"product_size",title:"产品规格",width:250},{field:"unit",title:"单位",align:"center"},{field:"quantity",title:"数量",align:"center"},{field:"remarks",title:"备注",align:"center"}],attachmentColumns:[{type:"checkbox",width:60},{type:"seq",width:50,title:"#"},{field:"filename",title:"文件名",showOverflow:!0},{field:"object_id",title:"object_id",visible:!1},{field:"stored_name",title:"object_id",visible:!1},{field:"file_size",title:"大小",align:"center",formatter:function(e){var t=e.cellValue;return null==t||""===t?"":(t/1048576).toFixed(2)+" MB"}},{field:"upload_time",title:"上传时间",width:160,align:"center"},{title:"操作",width:140,align:"center",slots:{default:function(a){var r=a.row;return[t("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(){return e.openLocalFile(r)}}},["打开"]),t("vxe-button",{attrs:{size:"mini",status:"primary"},on:{click:function(){return e.download(r)}}},["下载"])]}}}]}},created:function(){},mounted:function(){var e=this;this.getOptions(),this.$refs.xGrid.commitProxy("query").then((function(){e.$nextTick((function(){return setTimeout(e.autoRecover,0)}))}))},methods:{batchPurchaseDownload:function(e){var t=this.$refs.xGrid.getCheckboxRecords();t.length?(this.batchShippingIds=t.map((function(e){return e.purchase_number})),this.batchType=e,this.doBatchDownload()):u["VXETable"].modal.message({content:"请先勾选要下载的行",status:"warning"})},doBatchDownload:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.withLoading(Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a="pdf"===e.batchType?"batch_download_pdf":"batch_download_excel",t.next=3,Object(d["b"])({action:"purchase_table_view",subaction:a,purchaseids:e.batchShippingIds},{responseType:"blob",timeout:0});case 3:r=t.sent,n=(new Date).toISOString().slice(0,10),"pdf"===e.batchType?u["VXETable"].saveFile({filename:"采购单批量PDF_".concat(n,".zip"),type:"zip",content:r.data}):u["VXETable"].saveFile({filename:"采购单批量Excel_".concat(n,".zip"),type:"zip",content:r.data});case 6:case"end":return t.stop()}}),t)})))).catch((function(){e.$message.error("批量下载失败")}));case 2:case"end":return t.stop()}}),t)})))()},batchDownload:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){var r,n,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.$refs["gridAttach_"+e.purchase_number],n=r.getCheckboxRecords(),n.length){a.next=5;break}return u["VXETable"].modal.message({content:"请先勾选要下载的附件",status:"warning"}),a.abrupt("return");case 5:o=n.map((function(e){return e.attachmentid})),t.withLoading(Object(c["a"])(Object(i["a"])().mark((function a(){var r,n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(d["a"])({action:"attachment_file_view",subaction:"batch_download",ids:o},{responseType:"blob",timeout:0});case 3:r=a.sent,n=e.purchase_number?"附件 ".concat(e.purchase_number):"attachments.zip",u["VXETable"].saveFile({filename:n,type:"zip",content:r.data}),a.next=11;break;case 8:a.prev=8,a.t0=a["catch"](0),t.$message.error("下载失败");case 11:case"end":return a.stop()}}),a,null,[[0,8]])}))));case 7:case"end":return a.stop()}}),a)})))()},openLocalFile:function(e){var t=arguments,a=this;return Object(c["a"])(Object(i["a"])().mark((function r(){var n,o,c,l,d,p,m,v,_,x,g,w;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=t.length>1&&void 0!==t[1]&&t[1],null!==(n=e)&&void 0!==n&&n.row&&(e=e.row),c=e.stored_name,c){r.next=6;break}return u["VXETable"].modal.message({content:"记录里没有文件名",status:"error"}),r.abrupt("return");case 6:return l=h["Loading"].service({lock:!0,text:"文件打开中…",spinner:"el-icon-loading",background:"rgba(0,0,0,0.15)"}),d=f+e.object_id+"\\"+c,console.log(d),a.lastOpenedPath=o?"":d,r.prev=10,p=500,r.next=14,Promise.all([fetch("".concat(b,"/open"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:d,readonly:o,user:a.name})}),new Promise((function(e){return setTimeout(e,p)}))]);case 14:if(m=r.sent,v=Object(s["a"])(m,1),_=v[0],200!==_.status){r.next=19;break}return r.abrupt("return");case 19:if(423!==_.status){r.next=28;break}return r.next=22,_.json();case 22:return x=r.sent,g=x.lock_info,w="".concat(g.user," @ ").concat(g.host," 正在编辑。\n要只读打开吗？"),r.next=27,a.$confirm(w,"文件被占用",{confirmButtonText:"只读打开",cancelButtonText:"取消",type:"warning"});case 27:return r.abrupt("return",a.openLocalFile(e,!0));case 28:return r.t0=Error,r.next=31,_.text();case 31:throw r.t1=r.sent,new r.t0(r.t1);case 35:r.prev=35,r.t2=r["catch"](10),u["VXETable"].modal.message({content:"打开失败："+(r.t2.message||"请检查本地助手是否已启动"),status:"error"});case 38:return r.prev=38,l.close(),r.finish(38);case 41:case"end":return r.stop()}}),r,null,[[10,35,38,41]])})))()},releaseLock:function(){this.lastOpenedPath&&fetch("".concat(b,"/release"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:this.lastOpenedPath})}).catch((function(){}))},download:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.withLoading(Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["a"])({action:"attachment_file_view",subaction:"download",id:e.attachmentid},{responseType:"blob",noCodeCheck:!0});case 2:a=t.sent,r=e.filename.split(".").pop(),n=e.filename.replace(new RegExp("\\.".concat(r,"$"),"i"),""),u["VXETable"].saveFile({filename:n,type:r,content:a.data});case 6:case"end":return t.stop()}}),t)})))).catch((function(){t.$message.error("下载失败")}));case 1:case"end":return a.stop()}}),a)})))()},withLoading:function(e){var t=h["Loading"].service({lock:!0,text:"生成中，请稍候…",background:"rgba(0, 0, 0, 0.4)"});return e().finally((function(){return t.close()}))},formatRemark:function(e){return m(e,60)},queryDataHandle:function(){var e=this,t=this.getSelectedRow();if(t){var a=this.$refs.xGrid,r=!a.isExpandByRow(t);a.toggleRowExpand(t,r),this.$nextTick((function(){e.handleToggleExpand({row:t,expanded:r})}))}},handleToggleExpand:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){var r,n,o,s;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.row,n=e.expanded,n){a.next=3;break}return a.abrupt("return");case 3:if(r._ship){a.next=9;break}return a.next=6,Object(d["b"])({action:"purchase_detail_table_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{purchase_number:r.purchase_number}});case 6:o=a.sent,t.$set(r,"_ship",o.data||[]),t.$set(r,"_shipLoaded",Date.now());case 9:if(r._attach){a.next=15;break}return a.next=12,Object(d["b"])({action:"attachment_file_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{model:"app.PurchaseTable",purchase_number:r.purchase_number}});case 12:s=a.sent,t.$set(r,"_attach",s.data||[]),t.$set(r,"_attachLoaded",Date.now());case 15:case"end":return a.stop()}}),a)})))()},handleCurrentChange:function(e){var t=e.row;this.currentRow=t},getSelectedRow:function(){return this.currentRow?this.currentRow:(u["VXETable"].modal.message({content:"请先单击选择一行",status:"warning"}),null)},ChangeloadRowHandle:function(){var e=this.getSelectedRow();e&&this.ChangeloadRow(e)},dowloadFileHandle:function(){var e=this.getSelectedRow();e&&this.downloadRow(e)},downloadExcelHandle:function(){var e=this.getSelectedRow();e&&this.downloadRowExcel(e)},editRowHandle:function(){var e=this.getSelectedRow();e&&this.queryDetailRow(e)},deleteRowHandle:function(){var e=this.getSelectedRow();e&&this.deleteRow(e)},downloadRowExcel:function(e){var t=this;this.withLoading((function(){return Object(d["c"])({purchase_excel:e.purchase_number}).then((function(a){var r=a.headers["my_file_type"];if(!r){var n=new FileReader;return n.onload=function(){return t.$message.error(JSON.parse(n.result).msg||"下载失败")},void n.readAsText(a.data)}var o="采购单 ".concat(e.purchase_number);u["VXETable"].saveFile({filename:o,type:r,content:a.data})}))})).catch((function(){return t.$message.error("下载失败")}))},ChangeloadRow:function(e){this.modalDisplayPrint=!0;var t=1===e.AOG_status?"未到货":"已到货";this.selectedOption.AOG_status=t,this.selectedOption.purchaseid=e.purchaseid},EnterChangeloadRow:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n,o,s,c,l,p,m,h;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$refs.xGrid,r=a.getTableData(),n=r.fullData,o=n.find((function(t){return t.purchaseid===e.selectedOption.purchaseid})),o){t.next=5;break}return t.abrupt("return");case 5:return s=e.selectedOption.AOG_status,c="未到货"===s?1:2,l=o.AOG_status,p=o.AOG_status,o.AOG_status=s,o.AOG_status=c,m=a.getColumns(),h=m.find((function(e){return"AOG_status"===e.field})),h&&a.refreshColumn(h),t.prev=14,t.next=17,Object(d["b"])({action:"purchase_table_view",subaction:"editStatus",purchaseid:o.purchaseid,AOG_status:c});case 17:e.modalDisplayPrint=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),t.next=27;break;case 21:t.prev=21,t.t0=t["catch"](14),o.AOG_status=l,o.AOG_status=p,h&&a.refreshColumn(h),u["VXETable"].modal.message({content:t.t0.message||"提交失败",status:"error"});case 27:case"end":return t.stop()}}),t,null,[[14,21]])})))()},renderAOGStatusFormatter:function(e){var t=e.row,a=1===t.AOG_status?"未到货":"已到货",r=1===t.AOG_status?"red":"green";return'<span style="font-weight:bold; color:'.concat(r,';">').concat(a,"</span>")},getOptions:function(){var e=this,t={action:"purchase_table_view",subaction:"getOptions"};Object(d["b"])(t).then((function(t){e.selectoptions=t.data}))},addRow:function(){this.$router.push({path:"/erppurchase/purchase_manifest"})},modalSubmitEvent:function(){var e=this,t={action:"purchase_table_view",subaction:"addRecord",modalForm:this.modalForm};Object(d["b"])(t).then((function(t){e.modalDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},deleteRow:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){var r;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$confirm("此操作将永久删除该记录，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0});case 2:return r={action:"purchase_table_view",subaction:"deleteRecord",idmap:{purchaseid:e.purchaseid}},a.next=5,Object(d["b"])(r);case 5:return a.next=7,t.$refs.xGrid.remove(e);case 7:u["VXETable"].modal.message({content:"删除成功",status:"success"});case 8:case"end":return a.stop()}}),a)})))()},downloadRow:function(e){var t=this;this.withLoading((function(){return Object(d["c"])({purchase_number:e.purchase_number}).then((function(t){u["VXETable"].saveFile({filename:"采购单 ".concat(e.purchase_number),type:t.headers["my_file_type"],content:t.data})}))})).catch((function(){return t.$message.error("下载失败")}))},editRow:function(e){this.$router.push({path:"/erppurchase/purchase_manifest_modify",query:{purchase_number:e.purchase_number}})},modalEditSubmitEvent:function(){var e=this,t={action:"purchase_table_view",subaction:"editRecord",modalEditForm:this.modalEditForm,idmap:{purchaseid:this.modalEditForm.purchaseid}};Object(d["b"])(t).then((function(t){e.modalEditDisplay=!1,u["VXETable"].modal.message({content:"提交成功",status:"success"}),e.$refs.xGrid.commitProxy("reload")}))},searchEvent:function(){this.$refs.xGrid.commitProxy("reload")},resetEvent:function(){var e=this,t=this.purchasesearchFormData;Object.keys(t).forEach((function(a){return e.$delete(t,a)})),this.$refs.xGrid.commitProxy("reload")},queryDetailRow:function(e){var t=this.$refs.xGrid.getRowIndex(e);this.$store.commit("SET_SELECT_ROW",t);var a=this.$refs.xGrid.getProxyInfo().pager;this.$store.commit("SET_CURRENT_PAGE",a.currentPage);var r=this.$refs.xGrid.$el.querySelector(".vxe-table--body-wrapper"),n=r?r.scrollTop:0;this.$store.commit("SET_SCROLL_TOP",n);var o=this.$refs.xGrid,s=o.getRowExpandRecords(),i=s.map((function(e){return e.purchase_number}));this.$store.commit("SET_EXPANDED_ROWS",i),console.log("[Save] index=",t," scroll=",n),this.$router.push({path:"/erppurchase/purchase_manifest_modify",query:{purchase_number:e.purchase_number}})},autoRecover:function(){var e=this;return Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.list_current_page,r=e.$refs.xGrid,null==a){t.next=8;break}return n=r.getProxyInfo(),n&&n.pager&&(n.pager.currentPage=a),t.next=7,r.commitProxy("query");case 7:e.$store.commit("SET_CURRENT_PAGE",null);case 8:e.$nextTick(Object(c["a"])(Object(i["a"])().mark((function t(){var a,r,n,s,c,l,u;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.$refs.xGrid,r=a.getTableData().fullData,n=r.filter((function(t){return e.expanded_rows.includes(t.purchase_number)})),s=Object(o["a"])(n);try{for(s.s();!(c=s.n()).done;)l=c.value,e.loadExpandData(l),a.setRowExpand(l,!0)}catch(i){s.e(i)}finally{s.f()}if(null==e.list_scroll_top){t.next=12;break}return t.next=8,e.$nextTick((function(){var t=e.$refs.xGrid;t.refreshScroll()}));case 8:return t.next=10,new Promise((function(e){return setTimeout(e,0)}));case 10:return t.next=12,new Promise((function(t,a){var r=e.$refs.xGrid;r.scrollTo(null,e.list_scroll_top).then(t).catch(a)}));case 12:null!=e.select_row_number&&(u=r[e.select_row_number],u&&a.setCurrentRow(u),e.currentRow=u),e.$store.commit("SET_EXPANDED_ROWS",[]),e.$store.commit("SET_SCROLL_TOP",null),e.$store.commit("SET_SELECT_ROW",null);case 16:case"end":return t.stop()}}),t)}))));case 9:case"end":return t.stop()}}),t)})))()},loadExpandData:function(e){var t=this;return Object(c["a"])(Object(i["a"])().mark((function a(){var r,n,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.purchase_number,a.next=3,Object(d["b"])({action:"purchase_detail_table_view",subaction:"query",pageNum:1,pageSize:1e4,searchForm:{purchase_number:r}});case 3:return n=a.sent,t.$set(e,"_ship",n.data||[]),t.$set(e,"_shipLoaded",Date.now()),a.next=8,Object(d["b"])({action:"attachment_file_view",subaction:"query",pageNum:1,pageSize:1e3,searchForm:{model:"app.PurchaseTable",purchase_number:e.purchase_number}});case 8:o=a.sent,t.$set(e,"_attach",o.data||[]),t.$set(e,"_attachLoaded",Date.now());case 11:case"end":return a.stop()}}),a)})))()}}},_=v,x=a("2877"),g=Object(x["a"])(_,r,n,!1,null,null,null);t["default"]=g.exports},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,o=a("44d2"),s=a("ae40"),i="find",c=!0,l=s(i);i in[]&&Array(1)[i]((function(){c=!1})),r({target:"Array",proto:!0,forced:c||!l},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),o(i)},d96b:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return i}));var r=a("5530"),n=a("b775");function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/process/"),method:"post",data:e,timeout:5e3},t))}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"".concat("","/vue-element-admin/backend/download_file/"),method:"get",params:e,responseType:"blob",timeout:0},t))}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["a"])(Object(r["a"])({url:"/vue-element-admin/backend/process/",method:"post",data:e,responseType:"blob",noCodeCheck:!0,timeout:0},t))}},e9c4:function(e,t,a){var r=a("23e7"),n=a("d066"),o=a("d039"),s=n("JSON","stringify"),i=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,l=/^[\uDC00-\uDFFF]$/,u=function(e,t,a){var r=a.charAt(t-1),n=a.charAt(t+1);return c.test(e)&&!l.test(n)||l.test(e)&&!c.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},d=o((function(){return'"\\udf06\\ud834"'!==s("\udf06\ud834")||'"\\udead"'!==s("\udead")}));s&&r({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,a){var r=s.apply(null,arguments);return"string"==typeof r?r.replace(i,u):r}})},fffc:function(e,t,a){"use strict";var r=a("23e7"),n=a("2266"),o=a("1c0b"),s=a("825a");r({target:"Iterator",proto:!0,real:!0},{find:function(e){return s(this),o(e),n(this,(function(t){if(e(t))return n.stop(t)}),void 0,!1,!0).result}})}}]);